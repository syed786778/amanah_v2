<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Amanah - Secure marriage profile photo sharing with OTP protection by Syed Rashad">
    <title>Amanah - Secure Matrimonial Photo Sharing</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Base styles */
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .btn-gradient-purple {
            background: linear-gradient(135deg, #a855f7, #9333ea);
            transition: all 0.3s ease;
        }
        .btn-gradient-purple:hover {
            background: linear-gradient(135deg, #9333ea, #7e22ce);
            transform: translateY(-1px);
        }
        
        .secure-image-container {
            position: relative;
            display: inline-block;
            -webkit-user-select: none;
            user-select: none;
        }
        .viewer-thumbnail {
            width: 100%;
            height: 200px;
            background-color: #1f2937;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .viewer-thumbnail canvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; 
            width: auto !important;
            height: auto !important;
        }

        .btn-disabled {
            background-color: #6b7280;
            cursor: not-allowed;
            opacity: 0.6;
            pointer-events: none;
        }

        .screenshot-block-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .screenshot-block-overlay.active {
            display: flex;
        }

        body {
            -webkit-user-select: none; 
            -moz-user-select: none; 
            -ms-user-select: none; 
            user-select: none;
            overflow-x: hidden;
        }
    </style>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPHFTQYLE1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YPHFTQYLE1');
    </script>
</head>
<body class="bg-gray-900 text-gray-200" oncopy="return false;" oncut="return false;">
    
    <div id="screenshot-block-overlay" class="screenshot-block-overlay">
        <svg class="w-24 h-24 text-red-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
        </svg>
        <h2 class="text-2xl font-bold text-white mb-2">‚ö†Ô∏è Screenshot Detected</h2>
        <p class="text-gray-300 text-center px-4">Screenshots are prohibited. You will be logged out shortly.</p>
    </div>

    <div id="app"></div>
    
    <script>
        // --- Supabase Config ---
        const SUPABASE_URL = 'https://imiljivxosyrcosznklh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltaWxqaXZ4b3N5cmNvc3pua2xoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMTIwOTcsImV4cCI6MjA3OTY4ODA5N30.TOgeuC3-RdG2ywIxDz2NWRhLHI4gxTkG4pilaZBqhso';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // --- Security Variables ---
        let visibilityChangeCount = 0;
        let lastVisibilityChange = 0;
        let protectionActive = false;

        // --- State Management ---
        let state = {
            view: 'home', // options: home, upload, manage, gallery, viewer, view, terms, privacy
            currentAlbum: null,
            uploaderInfo: { name: '', email: '' },
            photos: [],
            shareLink: '',
            otp: '',
            otpExpiry: null,
            viewerOtp: '',
            albumIdToView: '',
            isVerified: false,
            loading: false,
            lightboxIndex: null,
            manageEmail: '',
            termsAccepted: false,
            screenshotAttempts: 0 
        };
        
        // --- Utils ---
        function genOTP(){return Math.floor(100000+Math.random()*900000).toString()}
        function genAlbumId(){return'album_'+Math.random().toString(36).substr(2,9)}
        
        function formatTime(e){
            const r=e-Date.now();
            if(r<=0)return 'Expired';
            const t=Math.floor(r/36e5);
            const n=Math.floor(r%36e5/6e4);
            if (t > 0) return `${t}h ${n}m`;
            else if (n > 0) return `${n}m`;
            else return 'less than 1m';
        }

        // --- Navigation ---
        function nav(e){
            protectionActive=false;
            state.view=e;
            window.scrollTo(0, 0);
            
            // Reset state on main nav changes
            if(e==='home'||e==='upload'||e==='viewer'){
                state.photos=[];
                state.uploaderInfo={name:'',email:''};
                state.currentAlbum=null;
                state.isVerified=false;
                state.viewerOtp='';
                state.albumIdToView='';
                state.lightboxIndex=null;
                state.screenshotAttempts=0;
            }
            render();
        }
        
        // --- Form Handlers ---
        function toggleTerms(checkbox) {
            state.termsAccepted = checkbox.checked;
            checkUploadFormComplete(); 
            render();
        }
        
        let uploadFormComplete = false;
        function checkUploadFormComplete() {
            const isComplete = !!state.uploaderInfo.name && !!state.uploaderInfo.email && state.photos.length > 0 && state.termsAccepted;
            if (isComplete !== uploadFormComplete) {
                uploadFormComplete = isComplete;
                render();
            }
        }
        
        function updateUploaderName(input) { state.uploaderInfo.name = input.value; checkUploadFormComplete(); }
        function updateUploaderEmail(input) { state.uploaderInfo.email = input.value; checkUploadFormComplete(); }

        let verifyFormComplete = false;
        function checkVerifyFormComplete() {
            const isComplete = !!state.albumIdToView && !!state.viewerOtp && state.viewerOtp.length === 6;
            if (isComplete !== verifyFormComplete) {
                verifyFormComplete = isComplete;
                render();
            }
        }

        function updateAlbumId(input) {
            const value = input.value.trim();
            const urlMatch = value.match(/album=(album_[a-z0-9]+)/);
            state.albumIdToView = urlMatch ? urlMatch[1] : value;
            checkVerifyFormComplete();
        }

        function updateViewerOtp(input) { state.viewerOtp = input.value; checkVerifyFormComplete(); }
        
        let manageFormComplete = false;
        function checkManageFormComplete() {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const isComplete = emailRegex.test(state.manageEmail);
            if (isComplete !== manageFormComplete) {
                manageFormComplete = isComplete;
                render();
            }
        }
        function updateManageEmail(input) { state.manageEmail = input.value; checkManageFormComplete(); }

        // --- Security Logic ---
        function scrambleCanvasPixels(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const width = canvas.offsetWidth || 600; 
            const height = canvas.offsetHeight || 400;
            canvas.width = width;
            canvas.height = height;
            ctx.fillStyle = '#1f2937'; 
            ctx.fillRect(0, 0, width, height);
            ctx.save();
            ctx.fillStyle = 'rgba(255, 0, 0, 0.9)';
            ctx.font = 'bold 50px Arial'; 
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ACCESS DENIED', width / 2, height / 2);
            ctx.restore();
        }

        function handleScreenshotAttempt() {
            state.screenshotAttempts++;
            const canvasElements = document.querySelectorAll('canvas[id^="secure-photo-"]');
            canvasElements.forEach(canvas => scrambleCanvasPixels(canvas.id));
            const overlay = document.getElementById('screenshot-block-overlay');
            if (overlay) {
                overlay.classList.add('active');
                setTimeout(() => {
                    nav('home');
                    alert('You have been logged out due to unauthorized screen capture attempt.');
                }, 1000); 
            }
        }

        function showScreenshotWarning() {
            alert('‚ö†Ô∏è Screenshots and screen recording are strictly prohibited!');
            state.screenshotAttempts++;
            if (state.screenshotAttempts >= 2) handleScreenshotAttempt();
        }
        
        function setupProtection() {
            if (protectionActive) return;
            protectionActive = true;
            const contextMenuBlocker = e => { e.preventDefault(); showScreenshotWarning(); };
            const keyBlocker = e => {
                if (e.keyCode === 123 || e.key === 'PrintScreen' || (e.metaKey && e.shiftKey && (e.key === '3' || e.key === '4')) || (e.ctrlKey && e.key === 'p')) {
                    e.preventDefault(); handleScreenshotAttempt(); 
                }
            };
            document.addEventListener('contextmenu', contextMenuBlocker);
            document.addEventListener('keydown', keyBlocker);
            // Visibility API check
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden') {
                   // Mobile app switcher logic could go here
                }
            });
        }
        
        // --- Canvas Rendering ---
        function drawPhotoOnCanvas(canvasId, photoData, watermarkText, isLightbox = false) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                if(isLightbox) {
                    canvas.style.maxWidth = '100%';
                    canvas.style.maxHeight = '90vh';
                    canvas.style.width = 'auto';
                    canvas.style.height = 'auto';
                } else {
                    canvas.style.width = '100%';
                    canvas.style.height = '100%'; 
                }
                ctx.drawImage(img, 0, 0);
                // Watermark
                ctx.save();
                ctx.globalAlpha = 0.08;
                ctx.fillStyle = 'white';
                const watermarkSize = Math.max(100, img.width / 10); 
                ctx.font = `bold ${watermarkSize}px Arial`; 
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.translate(img.width / 2, img.height / 2);
                ctx.rotate(-45 * Math.PI / 180);
                ctx.fillText(watermarkText || 'Amanah Secured', 0, 0);
                ctx.restore();
            };
            img.src = photoData;
        }

        // --- Sharing ---
        function createShareMessage() {
            const albumName = state.currentAlbum ? state.currentAlbum.name : 'Secured Photos';
            return `*--- Amanah Secure Photo Share ---*\nHello, here is the link to view the photo album for *${albumName}*.\n\nüîí *Album Access Details:*\n- *Share Link:* ${state.shareLink}\n- *OTP:* ${state.otp}\n\n*Instructions:* Tap the link, then enter the OTP to view. Access is valid for ${formatTime(state.otpExpiry)}.`.trim();
        }
        function copyText() { navigator.clipboard.writeText(createShareMessage()); alert('Details copied!'); }
        function shareViaWhatsApp() { window.open(`https://wa.me/?text=${encodeURIComponent(createShareMessage())}`, '_blank'); }

        // --- Lightbox ---
        function openLightbox(index){state.lightboxIndex=index;render();setTimeout(setupProtection,100);}
        function closeLightbox(){state.lightboxIndex=null;render();}
        function nextPhoto(){if(state.lightboxIndex<state.currentAlbum.photos.length-1){state.lightboxIndex++;render();setTimeout(setupProtection,100);}}
        function prevPhoto(){if(state.lightboxIndex>0){state.lightboxIndex--;render();setTimeout(setupProtection,100);}}
        
        // --- File Handling ---
        function handleFiles(e){
            const maxPhotos = 4;
            const t=Array.from(e.target.files);
            Promise.all(t.map(e=>new Promise(t=>{
                const n=new FileReader();
                n.onload=e=>t(e.target.result);
                n.readAsDataURL(e)
            }))).then(e=>{
                state.photos=[...state.photos,...e].slice(0, maxPhotos);
                checkUploadFormComplete();
                render()
            })
        }
        
        // --- Supabase Actions ---
        async function manageAlbum(){ 
            if(!manageFormComplete){alert('Please enter a valid email address.');return}
            state.loading=true;render();
            try{
                const{data:albums,error}=await supabase.from('albums').select('*').eq('email',state.manageEmail.trim().toLowerCase()).limit(1);
                if(error)throw error;
                if(!albums||albums.length===0){
                    alert('No albums found with this email address.');
                    state.loading=false;render();return
                }
                const album=albums[0];
                const{data:photos}=await supabase.from('photos').select('*').eq('album_id',album.id).order('created_at',{ascending:true});
                state.currentAlbum={...album,photos:photos.map(p=>p.photo_data)};
                state.otp=album.otp;
                state.otpExpiry=album.otp_expiry;
                state.shareLink=location.origin+location.pathname+'?album='+album.id;
                state.view='gallery';
                state.loading=false;
                render();
            }catch(e){
                console.error('Manage error:',e);
                alert('Failed to load albums: '+e.message);
                state.loading=false;render();
            }
        }
        
        async function upload(){
            if (!state.termsAccepted) { alert('You must accept the Terms & Conditions.'); return; }
            if(!state.uploaderInfo.name||!state.uploaderInfo.email||!state.photos.length){alert('Please fill all fields');return}
            state.loading=true;render();
            try{
                const e=genAlbumId(),t=genOTP(),n=Date.now()+864e5;
                const{data:a,error:o}=await supabase.from('albums').insert({id:e,name:state.uploaderInfo.name,email:state.uploaderInfo.email.trim().toLowerCase(),otp:t,otp_expiry:n,created_at:Date.now()}).select().single();
                if(o)throw o;
                const{error:r}=await supabase.from('photos').insert(state.photos.map(t=>({album_id:e,photo_data:t})));
                if(r)throw r;
                const{data:s,error:i}=await supabase.from('photos').select('*').eq('album_id',e).order('created_at',{ascending:true});
                if(i)throw i;
                state.currentAlbum={...a,photos:s.map(e=>e.photo_data)};
                state.otp=t;state.otpExpiry=n;state.shareLink=location.origin+location.pathname+'?album='+e;
                state.view='gallery';
                state.loading=false;render()
            }catch(e){console.error('Upload error:',e);alert('Failed to create album: '+e.message);state.loading=false;render()}
        }

        async function regenOTP(){
            if(!state.currentAlbum)return;
            state.loading=true;render();
            try{
                const e=genOTP(),t=Date.now()+864e5; 
                const {error:n}=await supabase.from('albums').update({otp:e,otp_expiry:t}).eq('id',state.currentAlbum.id);
                if(n)throw n;
                state.currentAlbum.otp=e;state.otp=e;state.otpExpiry=t;
                state.loading=false;alert('New OTP generated!');render();
            }catch(e){alert('Error: '+e.message);state.loading=false;render();}
        }
        
        async function expireOTP(){
            if(!state.currentAlbum)return;
            if(!confirm('Expire OTP now?'))return;
            state.loading=true;render();
            try{
                const e=Date.now()-1000;
                const{error:t}=await supabase.from('albums').update({otp_expiry:e}).eq('id',state.currentAlbum.id);
                if(t)throw t;
                state.currentAlbum.otp_expiry=e;state.otpExpiry=e;
                state.loading=false;alert('OTP expired.');render()
            }catch(e){alert('Error: '+e.message);state.loading=false;render()}
        }
        
        async function verify(){
            if(!verifyFormComplete){alert('Please check Album ID and OTP.');return}
            state.loading=true;render();
            try{
                const{data:e,error:t}=await supabase.from('albums').select('*').eq('id',state.albumIdToView).single();
                if(t||!e){alert('Album not found.');state.loading=false;render();return}
                if(Date.now()>e.otp_expiry){alert('OTP expired.');state.loading=false;render();return}
                if(e.otp!==state.viewerOtp){alert('Invalid OTP.');state.loading=false;render();return}
                const{data:n,error:a}=await supabase.from('photos').select('*').eq('album_id',state.albumIdToView).order('created_at',{ascending:true});
                if(a)throw a;
                state.currentAlbum={...e,photos:n.map(e=>e.photo_data)};
                state.isVerified=true;state.view='view';state.loading=false;render();
            }catch(e){alert('Error: '+e.message);state.loading=false;render();}
        }
        
        async function delAlbum(){
            if(!confirm('Delete this album permanently?'))return;
            state.loading=true;render();
            try{
                const{error:e}=await supabase.from('albums').delete().eq('id',state.currentAlbum.id);
                if(e)throw e;
                state.view='home';state.currentAlbum=null;state.loading=false;alert('Album deleted.');render()
            }catch(e){alert('Error: '+e.message);state.loading=false;render()}
        }

        // --- Render Functions ---

        function renderHeader() {
            const showMyAlbumButton = state.view === 'gallery';
            return `
                <header class="bg-gray-800 shadow-lg fixed w-full z-20 top-0 left-0">
                    <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
                        <a href="#" onclick="nav('home'); return false;" class="group">
                            <h1 class="text-2xl font-extrabold text-white cursor-pointer group-hover:opacity-90 transition-opacity">
                                <span class="text-purple-400">Amanah</span>
                            </h1>
                        </a>
                        <nav class="flex items-center gap-2">
                            <button onclick="nav('home')" class="text-sm font-semibold px-4 py-2 rounded-full transition-colors ${state.view === 'home' ? 'bg-purple-600 text-white' : 'text-gray-300 hover:text-white hover:bg-gray-700'}">
                                Home
                            </button>
                            ${state.view !== 'home' && state.view !== 'viewer' ? `
                                <button onclick="nav('gallery')" class="text-sm font-semibold px-4 py-2 rounded-full transition-colors ${state.view === 'gallery' ? 'bg-purple-600 text-white' : 'text-gray-300 hover:text-white hover:bg-gray-700'}">
                                    My Album
                                </button>
                            ` : ''}
                        </nav>
                    </div>
                </header>
            `;
        }
        
        function renderFooter(){ 
            return `
                <footer class="bg-gray-900 border-t border-gray-700 text-gray-500 mt-16 pb-8">
                    <div class="max-w-6xl mx-auto px-4 py-12">
                        <div class="grid md:grid-cols-4 gap-12">
                            <div class="md:col-span-2 space-y-6">
                                <div>
                                    <h3 class="text-xl font-bold text-purple-400 flex items-center mb-2">
                                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                        About Amanah
                                    </h3>
                                    <p class="text-gray-400 text-sm leading-relaxed">
                                        Amanah is a privacy-first photo sharing platform built specifically for matrimonial use. In the marriage process, profile photos are routinely shared over messaging apps and broker networks. Once shared, they are forwarded, saved, and stored without consent ‚Äî leaving families with no control. Amanah fixes this by using secure, time-bound albums protected by OTP access.
                                    </p>
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-white mb-2">About the Founder</h4>
                                    <p class="text-gray-400 text-sm leading-relaxed">
                                        Amanah was founded by Syed Rashad, based on firsthand experience navigating the matrimonial process. Seeing how images traveled across brokers and groups without accountability, he built Amanah to put control back in the hands of families.
                                    </p>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="text-lg font-bold mb-4 text-purple-400">Legal & Security</h3>
                                <ul class="space-y-3 text-sm">
                                    <li class="flex items-center text-red-400 font-medium bg-red-900/20 p-2 rounded">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                                        Cybercrime Warning
                                    </li>
                                    <li><a href="#" onclick="nav('terms'); return false;" class="text-gray-400 hover:text-purple-300 transition-colors">Terms & Conditions</a></li>
                                    <li><a href="#" onclick="nav('privacy'); return false;" class="text-gray-400 hover:text-purple-300 transition-colors">Privacy Policy</a></li>
                                </ul>
                            </div>
                            
                            <div>
                                <h3 class="text-lg font-bold mb-4 text-purple-400">Contact & Connect</h3>
                                <p class="text-sm text-gray-400 mb-1">Support Email:</p>
                                <a href="mailto:help.amanahapp@gmail.com" class="text-purple-300 hover:text-purple-100 text-sm block mb-6">help.amanahapp@gmail.com</a>
                                
                                <a href="https://www.linkedin.com/in/syed-rashad/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-full px-4 py-2 bg-blue-700 hover:bg-blue-600 text-white text-sm font-medium rounded-lg transition-colors">
                                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                                    Connect on LinkedIn
                                </a>
                                <p class="text-xs text-gray-600 mt-4">¬© 2025 Amanah by Syed Rashad</p>
                            </div>
                        </div>
                        <div class="border-t border-gray-800 mt-10 pt-6 text-center text-xs text-gray-600 font-arabic">ÿ£ŸÖÿßŸÜÿ© - Trustworthy Protection</div>
                    </div>
                </footer>
            `;
        }

        function renderLoading(){ 
            return '<div class="fixed inset-0 bg-gray-900 bg-opacity-90 z-50 flex flex-col items-center justify-center"><div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-purple-500"></div><span class="mt-4 text-xl font-semibold text-gray-300">Processing...</span></div>';
        }

        // --- Pages ---
        
        function renderTerms() {
            return `
            <div class="pt-24 max-w-4xl mx-auto px-4 min-h-screen">
                <h2 class="text-3xl font-bold text-white mb-6">Terms & Conditions</h2>
                <div class="bg-gray-800 rounded-xl p-8 text-gray-300 space-y-4">
                    <p>Welcome to Amanah. By using this service, you agree to the following terms:</p>
                    <ul class="list-disc pl-5 space-y-2">
                        <li><strong>Permitted Use:</strong> This platform is strictly for matrimonial and family proposal purposes. Any other use is prohibited.</li>
                        <li><strong>Content Ownership:</strong> You retain all rights to the photos you upload. You warrant that you have the right to share these images.</li>
                        <li><strong>Prohibited Actions:</strong> Viewers may not attempt to screenshot, screen record, or use external devices to capture images shared via Amanah.</li>
                        <li><strong>Data Lifecycle:</strong> Amanah is a transient sharing platform. Albums and photos may be deleted by the user at any time.</li>
                        <li><strong>Liability:</strong> While we employ anti-screenshot technology, no digital method is 100% foolproof. Amanah is not liable for unauthorized distribution of images outside the platform.</li>
                    </ul>
                    <button onclick="nav('home')" class="mt-6 bg-purple-600 px-6 py-2 rounded text-white">Back to Home</button>
                </div>
            </div>
            `;
        }

        function renderPrivacy() {
            return `
            <div class="pt-24 max-w-4xl mx-auto px-4 min-h-screen">
                <h2 class="text-3xl font-bold text-white mb-6">Privacy Policy</h2>
                <div class="bg-gray-800 rounded-xl p-8 text-gray-300 space-y-4">
                    <p>At Amanah, your privacy and dignity are our core mission.</p>
                    <h3 class="text-xl font-bold text-white mt-4">Data Collection</h3>
                    <p>We only collect the email address provided during album creation to allow you to manage your photos. We do not sell data to third parties.</p>
                    <h3 class="text-xl font-bold text-white mt-4">Photo Retention</h3>
                    <p>Photos are stored securely on our servers only for as long as you keep your album active. When you delete an album, photos are permanently removed.</p>
                    <h3 class="text-xl font-bold text-white mt-4">Access Control</h3>
                    <p>Only users with the unique Link and valid OTP can access your photos. You verify who receives these credentials.</p>
                    <button onclick="nav('home')" class="mt-6 bg-purple-600 px-6 py-2 rounded text-white">Back to Home</button>
                </div>
            </div>
            `;
        }

        function renderHome() {
            return `
                <div class="pt-24 min-h-screen flex flex-col">
                    <div class="w-full max-w-6xl mx-auto px-4 flex-grow flex flex-col justify-center items-center text-center">
                        <div class="mb-6 inline-block p-3 rounded-full bg-purple-900 bg-opacity-30 border border-purple-500/30">
                            <span class="text-purple-300 font-semibold tracking-wide uppercase text-sm">‚ú® The Safe Way to Share Proposals</span>
                        </div>
                        <h1 class="text-5xl md:text-7xl font-extrabold text-white tracking-tight mb-6 leading-tight">
                            Share Photos with <br />
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">Confidence & Dignity</span>
                        </h1>
                        <p class="text-xl text-gray-400 max-w-2xl mx-auto mb-12">
                            The specialized platform for matrimonial privacy. Share profile photos securely with suitors and families. Prevent forwarding, saving, and unauthorized circulation.
                        </p>
                        
                        <div class="grid md:grid-cols-2 gap-8 w-full max-w-4xl mx-auto mb-16 text-left">
                            <div class="bg-gray-800/50 p-6 rounded-xl border border-red-900/30 hover:border-red-700/50 transition-colors">
                                <h3 class="text-red-400 font-bold text-lg mb-2 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                                    THE REALITY
                                </h3>
                                <p class="text-gray-400 text-sm leading-relaxed">
                                    In the matrimonial search, profile photos are often forwarded to brokers, WhatsApp groups, and extended relatives without your knowledge. Once sent, these images circulate indefinitely, leaving you with no control over who views your family's profiles.
                                </p>
                            </div>
                            <div class="bg-gray-800/50 p-6 rounded-xl border border-purple-500/30 hover:border-purple-500/60 transition-colors">
                                <h3 class="text-purple-400 font-bold text-lg mb-2 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                    THE AMANAH SOLUTION
                                </h3>
                                <p class="text-gray-400 text-sm leading-relaxed">
                                    Secure your proposal discussions. With <strong>time-bound access controlled by OTP</strong> and anti-screenshot technology, you decide exactly which suitor or family sees the photos and for how long. Revoke access instantly if things don't work out.
                                </p>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-3 gap-8 w-full max-w-5xl">
                           <div onclick="nav('upload')" class="cursor-pointer group">
                                <div class="bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-700 hover:border-purple-500 transition-all duration-300 h-full transform group-hover:-translate-y-1">
                                    <div class="flex items-start mb-4">
                                        <div class="p-3 bg-purple-900 bg-opacity-30 rounded-lg mr-4">
                                            <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        </div>
                                        <h3 class="text-xl font-bold text-white mt-1">Share Photos</h3>
                                    </div>
                                    <p class="text-gray-400 text-sm mb-6 text-left">Create a secure album for a suitor. Upload photos, generate a link, and set OTP protection.</p>
                                    <span class="block w-full bg-purple-600 text-white py-2 rounded-lg font-semibold group-hover:bg-purple-700 text-center">Start Sharing</span>
                                </div>
                           </div>

                           <div onclick="nav('viewer')" class="cursor-pointer group">
                                <div class="bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-700 hover:border-pink-500 transition-all duration-300 h-full transform group-hover:-translate-y-1">
                                    <div class="flex items-start mb-4">
                                        <div class="p-3 bg-pink-900 bg-opacity-30 rounded-lg mr-4">
                                            <svg class="w-8 h-8 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                                        </div>
                                        <h3 class="text-xl font-bold text-white mt-1">View Album</h3>
                                    </div>
                                    <p class="text-gray-400 text-sm mb-6 text-left">Received a link? Enter the Album ID and OTP here to view the photos securely.</p>
                                    <span class="block w-full bg-pink-600 text-white py-2 rounded-lg font-semibold group-hover:bg-pink-700 text-center">View Photos</span>
                                </div>
                           </div>

                           <div onclick="nav('manage')" class="cursor-pointer group">
                                <div class="bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-700 hover:border-blue-500 transition-all duration-300 h-full transform group-hover:-translate-y-1">
                                    <div class="flex items-start mb-4">
                                        <div class="p-3 bg-blue-900 bg-opacity-30 rounded-lg mr-4">
                                            <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                        </div>
                                        <h3 class="text-xl font-bold text-white mt-1">My Albums</h3>
                                    </div>
                                    <p class="text-gray-400 text-sm mb-6 text-left">Manage your active albums. Check expiration, regenerate OTPs, or delete albums.</p>
                                    <span class="block w-full bg-blue-600 text-white py-2 rounded-lg font-semibold group-hover:bg-blue-700 text-center">Manage</span>
                                </div>
                           </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderUpload() {
            return `
                <div class="pt-24 max-w-2xl mx-auto px-4 min-h-screen">
                    <div class="bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-700">
                        <h2 class="text-3xl font-bold text-white mb-6">Create Secure Album</h2>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-gray-400 mb-2">Display Name (Visible to viewer)</label>
                                <input type="text" placeholder="e.g. Family of Sarah" 
                                    class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:border-purple-500 focus:outline-none"
                                    oninput="updateUploaderName(this)" value="${state.uploaderInfo.name}">
                            </div>
                            
                            <div>
                                <label class="block text-gray-400 mb-2">Your Email (To manage album later)</label>
                                <input type="email" placeholder="name@example.com" 
                                    class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:border-purple-500 focus:outline-none"
                                    oninput="updateUploaderEmail(this)" value="${state.uploaderInfo.email}">
                            </div>
                            
                            <div>
                                <label class="block text-gray-400 mb-2">Upload Photos (Max 4)</label>
                                <div class="border-2 border-dashed border-gray-700 rounded-lg p-8 text-center hover:border-purple-500 transition-colors cursor-pointer relative">
                                    <input type="file" accept="image/*" multiple class="absolute inset-0 opacity-0 cursor-pointer" onchange="handleFiles(event)">
                                    <svg class="w-10 h-10 text-gray-500 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    <span class="text-purple-400 font-medium">Click to upload</span>
                                </div>
                                <div class="grid grid-cols-4 gap-2 mt-4">
                                    ${state.photos.map((p, i) => `<div class="aspect-square bg-gray-900 rounded overflow-hidden border border-gray-700"><img src="${p}" class="w-full h-full object-cover"></div>`).join('')}
                                </div>
                            </div>
                            
                             <div class="flex items-start">
                                <div class="flex items-center h-5">
                                    <input id="terms" type="checkbox" onchange="toggleTerms(this)" ${state.termsAccepted ? 'checked' : ''} class="w-4 h-4 border border-gray-300 rounded bg-gray-50 focus:ring-3 focus:ring-purple-300">
                                </div>
                                <label for="terms" class="ml-2 text-sm font-medium text-gray-400">I agree to the <a href="#" onclick="nav('terms'); return false;" class="text-purple-400 hover:underline">Terms and Conditions</a>. I confirm I have the right to share these photos.</label>
                            </div>

                            <button onclick="upload()" 
                                class="w-full py-4 rounded-lg font-bold text-lg shadow-lg ${uploadFormComplete ? 'btn-gradient-purple text-white' : 'btn-disabled text-gray-400'}">
                                Generate Secure Link
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderManage() {
            return `
                <div class="pt-24 max-w-md mx-auto px-4 min-h-screen">
                    <div class="bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-700">
                        <h2 class="text-2xl font-bold text-white mb-6">Manage Albums</h2>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-gray-400 mb-2">Enter your email</label>
                                <input type="email" placeholder="name@example.com" 
                                    class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:border-purple-500 focus:outline-none"
                                    oninput="updateManageEmail(this)" value="${state.manageEmail}">
                            </div>
                            <button onclick="manageAlbum()" 
                                class="w-full py-3 rounded-lg font-bold shadow-lg ${manageFormComplete ? 'bg-blue-600 hover:bg-blue-700 text-white' : 'btn-disabled text-gray-400'}">
                                Find Albums
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderGallery() {
            if (!state.currentAlbum) return '';
            const isExpired = Date.now() > state.otpExpiry;
            return `
                <div class="pt-24 max-w-4xl mx-auto px-4 min-h-screen">
                    <div class="bg-gray-800 rounded-2xl p-6 mb-8 border border-gray-700">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-white">${state.currentAlbum.name}</h2>
                                <p class="text-sm text-gray-400">Created: ${new Date(state.currentAlbum.created_at).toLocaleDateString()}</p>
                            </div>
                            <div class="mt-4 md:mt-0 px-4 py-2 ${isExpired ? 'bg-red-900/50 text-red-400' : 'bg-green-900/50 text-green-400'} rounded-lg border ${isExpired ? 'border-red-900' : 'border-green-900'}">
                                Status: ${isExpired ? 'EXPIRED' : 'ACTIVE'}
                            </div>
                        </div>
                        
                        <div class="bg-gray-900 rounded-lg p-4 mb-6">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs text-gray-500 uppercase font-semibold">Share Link</label>
                                    <div class="flex mt-1">
                                        <input readonly value="${state.shareLink}" class="bg-gray-800 text-gray-300 text-sm rounded-l-lg p-2 w-full outline-none">
                                        <button onclick="copyLink()" class="bg-gray-700 hover:bg-gray-600 px-3 rounded-r-lg text-white">Copy</button>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-500 uppercase font-semibold">Current OTP</label>
                                    <div class="flex mt-1">
                                        <input readonly value="${state.otp}" class="bg-gray-800 text-purple-400 font-mono text-lg font-bold rounded-l-lg p-2 w-full outline-none">
                                        <button onclick="copyOtp()" class="bg-gray-700 hover:bg-gray-600 px-3 rounded-r-lg text-white">Copy</button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Expires in: ${formatTime(state.otpExpiry)}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-3 mb-8">
                            <button onclick="shareViaWhatsApp()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.463 1.065 2.876 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.084 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                                WhatsApp Share
                            </button>
                            <button onclick="regenOTP()" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-2 px-4 rounded-lg">Regenerate OTP</button>
                            <button onclick="expireOTP()" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg">Expire Now</button>
                            <button onclick="delAlbum()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">Delete Album</button>
                        </div>
                        
                        <h3 class="text-xl font-bold text-white mb-4">Photos in this Album</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            ${state.currentAlbum.photos.map((p, i) => `
                                <div class="relative group aspect-square bg-gray-900 rounded-lg overflow-hidden border border-gray-700">
                                    <div class="w-full h-full secure-image-container">
                                        <canvas id="secure-photo-mgr-${i}" class="w-full h-full object-cover"></canvas>
                                    </div>
                                    <button onclick="delPhoto(${i})" class="absolute top-2 right-2 bg-red-600 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                    </button>
                                </div>
                                <script>setTimeout(() => drawPhotoOnCanvas('secure-photo-mgr-${i}', '${p}', 'Owner View'), 100);<\/script>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderViewer() {
            return `
                <div class="pt-24 max-w-md mx-auto px-4 min-h-screen">
                    <div class="bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-700">
                        <div class="text-center mb-8">
                            <h2 class="text-2xl font-bold text-white mb-2">Secure Album Access</h2>
                            <p class="text-gray-400 text-sm">Please identify yourself to the system.</p>
                        </div>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-gray-400 mb-2">Album ID</label>
                                <input type="text" placeholder="Paste link or ID" 
                                    class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:border-pink-500 focus:outline-none"
                                    oninput="updateAlbumId(this)" value="${state.albumIdToView}">
                            </div>
                            
                            <div>
                                <label class="block text-gray-400 mb-2">One-Time Passcode (OTP)</label>
                                <input type="text" placeholder="6-digit code" maxlength="6"
                                    class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white text-center tracking-widest text-xl font-bold focus:border-pink-500 focus:outline-none"
                                    oninput="updateViewerOtp(this)" value="${state.viewerOtp}">
                            </div>
                            
                            <button onclick="verify()" 
                                class="w-full py-3 rounded-lg font-bold shadow-lg ${verifyFormComplete ? 'bg-pink-600 hover:bg-pink-700 text-white' : 'btn-disabled text-gray-400'}">
                                Unlock Photos
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderView() {
            if (!state.currentAlbum) return '';
            
            // Lightbox Overlay
            let lightboxHtml = '';
            if (state.lightboxIndex !== null) {
                const photo = state.currentAlbum.photos[state.lightboxIndex];
                lightboxHtml = `
                    <div id="lightbox-container" class="fixed inset-0 bg-black z-50 flex flex-col justify-center items-center" onclick="if(event.target===this)closeLightbox()">
                        <div class="absolute top-4 right-4 flex gap-4">
                            <span class="text-white bg-red-600 px-3 py-1 rounded text-sm animate-pulse">Screenshots Prohibited</span>
                            <button onclick="closeLightbox()" class="text-white hover:text-gray-300">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                        <div class="relative w-full h-full flex items-center justify-center p-4">
                            <button onclick="prevPhoto()" class="absolute left-4 text-white p-2 bg-gray-800/50 rounded-full hover:bg-gray-700">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            </button>
                            
                            <canvas id="lightbox-canvas" class="max-h-[85vh] max-w-full object-contain shadow-2xl border-4 border-gray-800"></canvas>
                            
                            <button onclick="nextPhoto()" class="absolute right-4 text-white p-2 bg-gray-800/50 rounded-full hover:bg-gray-700">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                        </div>
                        <p class="text-gray-500 text-sm mt-4">Photo ${state.lightboxIndex + 1} of ${state.currentAlbum.photos.length}</p>
                        <script>setTimeout(() => drawPhotoOnCanvas('lightbox-canvas', '${photo}', 'Protected by Amanah', true), 50);<\/script>
                    </div>
                `;
            }

            return `
                ${lightboxHtml}
                <div class="pt-24 max-w-4xl mx-auto px-4 min-h-screen">
                    <div class="text-center mb-8">
                        <div class="inline-block bg-green-900/30 text-green-400 px-4 py-1 rounded-full text-sm font-bold mb-4 border border-green-900">
                            üîí Secure Session Active
                        </div>
                        <h2 class="text-2xl font-bold text-white mb-2">Album: ${state.currentAlbum.name}</h2>
                        <p class="text-red-400 text-xs animate-pulse">Do not screenshot. This action will lock your session.</p>
                    </div>
                    
                    <div id="viewer-content-area" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${state.currentAlbum.photos.map((p, i) => `
                            <div onclick="openLightbox(${i})" class="bg-gray-800 p-2 rounded-xl shadow-lg cursor-pointer transform hover:scale-[1.02] transition-transform">
                                <div class="viewer-thumbnail rounded-lg overflow-hidden">
                                    <canvas id="secure-photo-view-${i}"></canvas>
                                </div>
                            </div>
                            <script>setTimeout(() => drawPhotoOnCanvas('secure-photo-view-${i}', '${p}', 'Protected View'), 100);<\/script>
                        `).join('')}
                    </div>
                    
                    <div class="mt-12 text-center">
                        <button onclick="nav('home')" class="text-gray-500 hover:text-white underline">Exit Secure Session</button>
                    </div>
                </div>
            `;
        }

        // --- Main Render ---
        function render() {
            const app = document.getElementById('app');
            let content = '';
            
            if (state.loading) {
                content = renderLoading();
            } else {
                switch(state.view) {
                    case 'home': content = renderHome(); break;
                    case 'upload': content = renderUpload(); break;
                    case 'manage': content = renderManage(); break;
                    case 'gallery': content = renderGallery(); break;
                    case 'viewer': content = renderViewer(); break;
                    case 'view': content = renderView(); break;
                    case 'terms': content = renderTerms(); break;
                    case 'privacy': content = renderPrivacy(); break;
                    default: content = renderHome();
                }
            }
            
            app.innerHTML = renderHeader() + content + renderFooter();
        }

        // --- Init ---
        // Check for URL params to auto-open viewer
        const urlParams = new URLSearchParams(window.location.search);
        const albumParam = urlParams.get('album');
        if (albumParam) {
            state.albumIdToView = albumParam;
            state.view = 'viewer';
            checkVerifyFormComplete();
        }
        
        render();
        
    </script>
</body>
</html>
