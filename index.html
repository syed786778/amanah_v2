<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Amanah - Secure marriage profile photo sharing with OTP protection by Syed Rashad">
    <title>Amanah - Secure Photo Sharing</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        blue: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        function renderGalleryView() {
            if (!state.currentAlbum) {
                return `
                    <div class="max-w-xl mx-auto px-4 pt-24 pb-16 text-center">
                        <div class="bg-white rounded-xl card-shadow p-8 border border-slate-200">
                            <svg class="w-16 h-16 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            <h2 class="text-2xl font-bold text-slate-900 mb-2">Album Not Found</h2>
                            <p class="text-slate-600 mb-6">Please return home and try accessing your album again.</p>
                            <button onclick="nav('home')" class="btn-primary text-white py-3 px-6 rounded-lg font-semibold shadow-md">Go Home</button>
                        </div>
                    </div>
                `;
            }

            const isExpired = Date.now() > state.otpExpiry;
            const otpStatus = isExpired 
                ? `<span class="text-red-600 font-semibold">EXPIRED</span>`
                : `<span class="text-green-600 font-semibold">${formatTime(state.otpExpiry)} remaining</span>`;

            return `
                <div class="max-w-7xl mx-auto px-4 pt-24 pb-16 min-h-screen">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-900 mb-2">My Secured Album</h2>
                        <p class="text-slate-600">Created by ${state.currentAlbum.name}</p>
                    </div>

                    <!-- Share Details Card -->
                    <div class="bg-gradient-to-br from-blue-50 to-white rounded-xl card-shadow p-6 mb-6 border border-blue-100">
                        <h3 class="text-xl font-bold text-slate-900 mb-4 flex items-center">
                            <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
                            Share Access Details
                        </h3>
                        
                        <div class="space-y-4 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Album Link</label>
                                <div class="flex gap-2">
                                    <input type="text" value="${state.shareLink}" readonly class="flex-grow px-4 py-2 bg-white border border-slate-300 rounded-lg text-slate-900 text-sm font-mono" />
                                    <button onclick="copyLink()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap">
                                        Copy Link
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Current OTP</label>
                                <div class="flex gap-2">
                                    <input type="text" value="${state.otp}" readonly class="flex-grow px-4 py-2 bg-white border border-slate-300 rounded-lg text-slate-900 text-2xl font-mono text-center tracking-widest" />
                                    <button onclick="copyOtp()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap">
                                        Copy OTP
                                    </button>
                                </div>
                                <p class="text-sm text-slate-600 mt-2">Expires in: ${otpStatus}</p>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="shareViaWhatsApp()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition-colors flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
                                Share via WhatsApp
                            </button>
                            <button onclick="copyText()" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-3 rounded-lg font-medium transition-colors">
                                Copy Full Message
                            </button>
                        </div>
                    </div>

                    <!-- Access Logs Card -->
                    <div class="bg-white rounded-xl card-shadow p-6 mb-6 border border-slate-200">
                        <h3 class="text-xl font-bold text-slate-900 mb-4 flex items-center">
                            <svg class="w-6 h-6 text-slate-700 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                            Access Logs
                        </h3>
                        <button onclick="loadAccessLogs()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg font-medium transition-colors shadow-sm mb-4">
                            View Access History
                        </button>
                        <div id="access-logs-container"></div>
                    </div>

                    <!-- Access Management Card -->
                    <div class="bg-white rounded-xl card-shadow p-6 mb-6 border border-red-100">
                        <h3 class="text-xl font-bold text-slate-900 mb-4 flex items-center">
                            <svg class="w-6 h-6 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                            Access Control
                        </h3>
                        <div class="grid md:grid-cols-3 gap-3">
                            <button onclick="regenOTP()" class="bg-amber-600 hover:bg-amber-700 text-white py-3 rounded-lg font-medium transition-colors shadow-sm">
                                Regenerate OTP
                            </button>
                            <button onclick="expireOTP()" class="bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-medium transition-colors shadow-sm">
                                Expire OTP Now
                            </button>
                            <button onclick="delAlbum()" class="bg-slate-700 hover:bg-slate-800 text-white py-3 rounded-lg font-medium transition-colors shadow-sm">
                                Delete Album
                            </button>
                        </div>
                    </div>

                    <!-- Photos Grid -->
                    <div class="bg-white rounded-xl card-shadow p-6 border border-slate-200">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">Photos (${state.currentAlbum.photos.length})</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4">
                            ${state.currentAlbum.photos.map((photo, index) => `
                                <div class="relative group cursor-pointer" onclick="openLightbox(${index})">
                                    <img src="${photo}" class="w-full h-32 object-cover rounded-lg border border-slate-200 transition-transform group-hover:scale-105" alt="Photo ${index + 1}">
                                    <button onclick="event.stopPropagation(); delPhoto(${index})" class="absolute top-2 right-2 w-7 h-7 bg-red-500 hover:bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-sm font-bold shadow-lg">
                                        ×
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                ${renderFooter()}
            `;
        }
        
        function renderViewerView() {
            if (!state.currentAlbum || !state.isVerified) {
                return `
                    <div class="max-w-xl mx-auto px-4 pt-24 pb-16 text-center">
                        <div class="bg-white rounded-xl card-shadow p-8 border border-slate-200">
                            <svg class="w-16 h-16 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                            <h2 class="text-2xl font-bold text-slate-900 mb-2">Access Denied</h2>
                            <p class="text-slate-600 mb-6">Please verify your credentials to view photos.</p>
                            <button onclick="nav('home')" class="btn-primary text-white py-3 px-6 rounded-lg font-semibold shadow-md">Go Home</button>
                        </div>
                    </div>
                `;
            }

            const isExpired = Date.now() > state.currentAlbum.otp_expiry;
            const timeRemaining = formatTime(state.currentAlbum.otp_expiry);

            const otpStatus = isExpired 
                ? `<span class="text-red-600 font-semibold">EXPIRED</span>`
                : `<span class="text-green-600 font-semibold">${timeRemaining} remaining</span>`;

            return `
                <div class="max-w-7xl mx-auto px-4 pt-24 pb-16 min-h-screen" id="viewer-content-area">
                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center w-14 h-14 bg-blue-100 rounded-xl mb-4">
                            <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                        </div>
                        <h2 class="text-3xl font-bold text-slate-900 mb-2">Secured Album</h2>
                        <p class="text-lg text-slate-600 mb-1">Shared by: <span class="font-semibold text-slate-900">${state.currentAlbum.name}</span></p>
                        <div class="inline-flex items-center bg-red-50 border border-red-200 rounded-full px-4 py-2 mt-2">
                            <svg class="w-4 h-4 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                            <span class="text-sm font-medium text-red-800">Screenshots strictly prohibited</span>
                        </div>
                        <p class="text-sm text-slate-500 mt-2">Access expires in: ${otpStatus}</p>
                    </div>

                    <!-- Report Button -->
                    <div class="mb-8 flex justify-center">
                        <button onclick="openReportModal()" class="inline-flex items-center bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 shadow-md hover:shadow-lg">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                            Report Inappropriate Content
                        </button>
                    </div>

                    <h3 class="text-xl font-bold text-slate-900 mb-4">Protected Photos (${state.currentAlbum.photos.length})</h3>
                    <p class="text-sm text-slate-600 mb-6">Click any photo to view securely</p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6">
                        ${state.currentAlbum.photos.map((photo, index) => `
                            <div class="bg-white rounded-xl card-shadow-hover overflow-hidden border border-slate-200 cursor-pointer group" onclick="openLightbox(${index})">
                                <div class="viewer-thumbnail relative">
                                    <svg class="w-12 h-12 text-blue-400 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                                    <div class="absolute bottom-3 left-0 right-0 text-center">
                                        <span class="text-xs font-medium text-slate-600 bg-white bg-opacity-90 px-3 py-1 rounded-full">Click to View</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button onclick="nav('home')" class="w-full mt-12 bg-slate-700 hover:bg-slate-800 text-white py-4 rounded-xl font-semibold transition-colors shadow-md">
                        Close & Logout
                    </button>
                </div>
                ${renderFooter()}
            `;
        }

        function renderAboutView() {
            return `
                <div class="min-h-screen pt-24 pb-16">
                    <div class="max-w-4xl mx-auto px-4">
                        <div class="bg-gradient-to-br from-blue-50 to-white rounded-2xl card-shadow p-10 mb-10 border border-blue-100">
                            <h2 class="text-3xl font-bold text-slate-900 text-center mb-6">About Amanah</h2>
                            
                            <div class="space-y-5 text-slate-700 leading-relaxed">
                                <p>
                                    Amanah is a privacy-first photo sharing platform designed specifically for sensitive matrimonial use cases. In traditional photo sharing, families lose control the moment a photo is sent—it can be saved, forwarded, and circulated indefinitely without consent.
                                </p>
                                
                                <p class="text-lg font-semibold text-blue-700">
                                    Amanah changes that by putting control back in your hands.
                                </p>
                                
                                <p>
                                    Using OTP-based authentication, time-bound access, and screenshot protection, Amanah ensures that matrimonial photos are viewed only by intended recipients and can be revoked at any time.
                                </p>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-2xl card-shadow p-10 border border-slate-200">
                            <h3 class="text-2xl font-bold text-slate-900 mb-6">About the Founder</h3>
                            
                            <div class="space-y-5 text-slate-700 leading-relaxed">
                                <p>
                                    Amanah was created by <span class="font-semibold text-slate-900">Syed Rashad</span>, who experienced firsthand how matrimonial photos are shared across families, relatives, and broker networks—often reaching unintended recipients with zero accountability.
                                </p>
                                
                                <p>
                                    Recognizing this as a structural problem requiring a technical solution, he built Amanah to embed privacy and consent directly into the photo-sharing process.
                                </p>
                                
                                <div class="bg-blue-50 border-l-4 border-blue-600 p-5 rounded-r-xl my-6">
                                    <p class="text-lg font-medium text-blue-900 italic">
                                        "Sharing a matrimonial photo is an act of trust—and that trust deserves protection."
                                    </p>
                                </div>
                                
                                <div class="flex justify-center mt-8">
                                    <a href="https://www.linkedin.com/in/syed-rashad/" target="_blank" rel="noopener noreferrer" 
                                       class="inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-all duration-300 shadow-md hover:shadow-lg">
                                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                                        Connect on LinkedIn
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    ${renderFooter()}
                </div>
            `;
        }

        function renderTermsView() {
            return `
                <div class="max-w-4xl mx-auto px-4 pt-24 pb-16 min-h-screen">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Terms & Conditions</h2>
                    <div class="bg-white rounded-xl card-shadow p-8 space-y-6 text-slate-700 border border-slate-200">
                        <div class="bg-red-50 border-l-4 border-red-600 p-4 rounded-r-lg">
                            <p class="font-bold text-red-900 mb-2">⚠️ CYBERCRIME WARNING</p>
                            <p class="text-sm text-red-800">Unauthorized sharing, screenshots, and screen recording are strictly prohibited and may result in legal action.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-bold text-slate-900 mb-3">1. Prohibition of Reproduction</h3>
                            <p class="text-sm leading-relaxed">You are explicitly prohibited from reproducing, screen capturing, screen recording, forwarding, distributing, or copying any content accessed through Amanah. Violations will result in immediate termination of access and may lead to legal action under applicable cybercrime laws.</p>
                        </div>

                        <div>
                            <h3 class="text-xl font-bold text-slate-900 mb-3">2. Access and OTP</h3>
                            <p class="text-sm leading-relaxed">Access is granted via a unique, time-limited One-Time Passcode (OTP). The OTP is non-transferable and for your personal viewing only. Photos are intended solely for matrimonial consideration.</p>
                        </div>

                        <div>
                            <h3 class="text-xl font-bold text-slate-900 mb-3">3. Security Mechanisms</h3>
                            <p class="text-sm leading-relaxed">Amanah employs canvas rendering, watermarking, and screenshot detection as deterrents. While these mechanisms provide strong protection, no system is 100% foolproof against determined technical circumvention.</p>
                        </div>

                        <div>
                            <h3 class="text-xl font-bold text-slate-900 mb-3">4. Uploader Responsibility</h3>
                            <p class="text-sm leading-relaxed">Uploaders warrant they have the legal right to share photos uploaded. Amanah is not responsible for album content. Contact information is used for account management and security logging only.</p>
                        </div>
                        
                        <div class="text-center pt-6">
                            <button onclick="nav('home')" class="btn-primary text-white py-3 px-8 rounded-lg font-semibold shadow-md">
                                I Understand and Agree
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderReportModal() {
            if (!state.showReportModal) return '';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl max-w-2xl w-full p-8 shadow-2xl">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-slate-900 mb-2 flex items-center">
                                    <svg class="w-7 h-7 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                                    Report Content
                                </h3>
                                <p class="text-slate-600 text-sm">Help us keep Amanah safe by reporting inappropriate content</p>
                            </div>
                            <button onclick="closeReportModal()" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
                        </div>
                        
                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Reason for Reporting *</label>
                                <select onchange="updateReportReason(this)" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-slate-900">
                                    <option value="">-- Select a reason --</option>
                                    <option value="Obscene or Inappropriate Images">Obscene or Inappropriate Images</option>
                                    <option value="Spam or Misleading Content">Spam or Misleading Content</option>
                                    <option value="Fake or Stolen Photos">Fake or Stolen Photos</option>
                                    <option value="Harassment or Threatening Content">Harassment or Threatening Content</option>
                                    <option value="Underage Individual">Underage Individual</option>
                                    <option value="Violation of Privacy">Violation of Privacy</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Additional Details (Optional)</label>
                                <textarea oninput="updateReportDetails(this)" rows="4" placeholder="Provide additional information..." class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-slate-900"></textarea>
                            </div>
                            
                            <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                                <p class="text-amber-800 text-sm flex items-start">
                                    <svg class="w-5 h-5 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                    <span><strong>Important:</strong> False reports may result in restricted access. Only report content that genuinely violates our terms.</span>
                                </p>
                            </div>
                            
                            <div class="flex space-x-4">
                                <button onclick="submitReport()" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition-all duration-300 shadow-md">
                                    Submit Report
                                </button>
                                <button onclick="closeReportModal()" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-3 rounded-lg font-semibold transition-all duration-300">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLightbox() {
            if (state.lightboxIndex === null || !state.currentAlbum) return '';

            const photo = state.currentAlbum.photos[state.lightboxIndex];
            const watermarkText = `${state.currentAlbum.name} (${state.currentAlbum.id})`;
            const canvasId = `secure-photo-lightbox`;
            
            setTimeout(() => drawPhotoOnCanvas(canvasId, photo, watermarkText, true), 50);

            return `
                <div id="lightbox-container" class="fixed inset-0 bg-black bg-opacity-95 z-40 flex items-center justify-center p-4">
                    
                    <button onclick="closeLightbox()" class="absolute top-4 right-4 text-white text-4xl w-12 h-12 flex items-center justify-center hover:bg-white hover:bg-opacity-20 rounded-full transition-colors z-50">
                        &times;
                    </button>

                    <div class="secure-image-container max-w-full max-h-[90vh] h-full w-full flex items-center justify-center">
                        <canvas id="${canvasId}" class="object-contain rounded-lg shadow-2xl"></canvas>
                        
                        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex items-center space-x-4 bg-white bg-opacity-90 px-6 py-3 rounded-full z-50">
                            <button onclick="prevPhoto()" ${state.lightboxIndex === 0 ? 'disabled' : ''}
                                class="w-10 h-10 flex items-center justify-center rounded-full ${state.lightboxIndex === 0 ? 'bg-slate-200 text-slate-400' : 'bg-blue-600 text-white hover:bg-blue-700'}">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                            </button>
                            <span class="text-slate-900 font-medium">${state.lightboxIndex + 1} / ${state.currentAlbum.photos.length}</span>
                            <button onclick="nextPhoto()" ${state.lightboxIndex === state.currentAlbum.photos.length - 1 ? 'disabled' : ''}
                                class="w-10 h-10 flex items-center justify-center rounded-full ${state.lightboxIndex === state.currentAlbum.photos.length - 1 ? 'bg-slate-200 text-slate-400' : 'bg-blue-600 text-white hover:bg-blue-700'}">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function render() {
            console.log('Rendering view:', state.view);
            const app = document.getElementById('app');
            
            if (!app) {
                console.error('App element not found!');
                return;
            }
            
            let content = renderHeader();

            if (state.loading) {
                content += renderLoading();
            } else {
                switch (state.view) {
                    case 'home':
                        content += renderHomeView();
                        break;
                    case 'about':
                        content += renderAboutView();
                        break;
                    case 'upload':
                        content += renderUploadView();
                        break;
                    case 'manage': 
                        content += renderManageInputView();
                        break;
                    case 'gallery':
                        content += renderGalleryView();
                        break;
                    case 'viewer': 
                        content += renderViewerInputView();
                        break;
                    case 'view':
                        content += renderViewerView();
                        break;
                    case 'terms':
                        content += renderTermsView();
                        break;
                    default:
                        content += renderHomeView();
                }
            }
            
            try {
                app.innerHTML = content;
                console.log('Content rendered successfully');
            } catch (error) {
                console.error('Error rendering content:', error);
            }
            
            if (state.showReportModal) {
                app.insertAdjacentHTML('beforeend', renderReportModal());
            }
            
            if (state.lightboxIndex !== null) {
                app.insertAdjacentHTML('beforeend', renderLightbox());
                if (state.view === 'view' && state.isVerified) {
                    setTimeout(setupProtection, 100);
                }
            } else {
                protectionActive = false;
            }

            if (state.view === 'viewer' && state.albumIdToView && !state.isVerified) {
                checkVerifyFormComplete();
            }
        }
        
        async function initializeApp() {
            console.log('Initializing Amanah app...');
            
            const urlParams = new URLSearchParams(window.location.search);
            const albumId = urlParams.get('album');
            
            window.addEventListener('hashchange', () => {
                const hash = window.location.hash.slice(1);
                state.view = hash || 'home';
                render();
            });
            
            if (albumId) {
                state.albumIdToView = albumId;
                state.view = 'viewer';
                window.location.hash = 'viewer';
            } else {
                const hash = window.location.hash.slice(1);
                state.view = hash || 'home';
            }
            
            console.log('Initial view:', state.view);
            render();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

    </script>
</body>
</html>
        
        .card-shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        .card-shadow-hover {
            transition: all 0.3s ease;
        }
        
        .card-shadow-hover:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #334155;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        .secure-image-container {
            position: relative;
            display: inline-block;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .viewer-thumbnail {
            width: 100%;
            height: 200px;
            background-color: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
        }
        
        .viewer-thumbnail canvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; 
            width: auto !important;
            height: auto !important;
        }

        .btn-disabled {
            background-color: #cbd5e1;
            color: #94a3b8;
            cursor: not-allowed;
            opacity: 0.6;
            pointer-events: none;
        }

        .screenshot-block-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .screenshot-block-overlay.active {
            display: flex;
        }

        body {
            -webkit-user-select: none; 
            -moz-user-select: none; 
            -ms-user-select: none; 
            user-select: none;
            overflow-x: hidden;
            background-color: #f8fafc;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.025em;
        }
        
        .badge-blue {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .badge-green {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .badge-orange {
            background-color: #fed7aa;
            color: #9a3412;
        }
        
        .feature-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
    </style>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPHFTQYLE1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YPHFTQYLE1');
    </script>
</head>
<body class="bg-slate-50 text-slate-900" oncopy="return false;" oncut="return false;">
    
    <div id="screenshot-block-overlay" class="screenshot-block-overlay">
        <svg class="w-24 h-24 text-red-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
        </svg>
        <h2 class="text-2xl font-bold text-white mb-2">⚠️ Screenshot Detected</h2>
        <p class="text-gray-300 text-center px-4">Screenshots are prohibited. You will be logged out shortly.</p>
    </div>

    <div id="app">
        <!-- Fallback content while JS loads -->
        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background-color: #f8fafc;">
            <div style="text-align: center;">
                <div style="display: inline-block; width: 50px; height: 50px; border: 3px solid #2563eb; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite;"></div>
                <p style="margin-top: 1rem; color: #64748b; font-size: 14px;">Loading Amanah...</p>
            </div>
        </div>
        <style>
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        </style>
    </div>
    
    <script>
        const SUPABASE_URL = 'https://imiljivxosyrcosznklh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltaWxqaXZ4b3N5cmNvc3pua2xoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMTIwOTcsImV4cCI6MjA3OTY4ODA5N30.TOgeuC3-RdG2ywIxDz2NWRhLHI4gxTkG4pilaZBqhso';
        
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let visibilityChangeCount = 0;
        let lastVisibilityChange = 0;
        let protectionActive = false;

        let state = {
            view: 'home',
            currentAlbum: null,
            uploaderInfo: { name: '', email: '' },
            photos: [],
            shareLink: '',
            otp: '',
            otpExpiry: null,
            viewerOtp: '',
            viewerName: '',
            albumIdToView: '',
            isVerified: false,
            loading: false,
            lightboxIndex: null,
            manageEmail: '',
            termsAccepted: false,
            screenshotAttempts: 0,
            rightClickAttempts: 0,
            showReportModal: false,
            reportReason: '',
            reportDetails: ''
        };
        
        function genOTP(){return Math.floor(100000+Math.random()*900000).toString()}
        function genAlbumId(){return'album_'+Math.random().toString(36).substr(2,9)}
        
        function formatTime(e){
            const r=e-Date.now();
            if(r<=0)return 'Expired';
            const t=Math.floor(r/36e5);
            const n=Math.floor(r%36e5/6e4);
            
            if (t > 0) {
                return `${t}h ${n}m`;
            } else if (n > 0) {
                return `${n}m`;
            } else {
                return 'less than 1m';
            }
        }
        
        function actionCard(title, icon, text, buttonText, action, badgeColor) {
            const colorClasses = {
                'blue': 'bg-blue-100',
                'orange': 'bg-orange-100',
                'green': 'bg-green-100'
            };
            
            return `
                <div class="bg-white rounded-xl card-shadow card-shadow-hover p-8 border border-slate-200">
                    <div class="feature-icon ${colorClasses[badgeColor] || 'bg-blue-100'}">
                        ${icon}
                    </div>
                    <h3 class="text-xl font-semibold text-slate-900 mb-3">${title}</h3>
                    <div class="text-slate-600 space-y-2 mb-6 text-sm leading-relaxed">${text}</div>
                    <button onclick="${action}" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium transition-all duration-300 shadow-sm hover:shadow-md">
                        ${buttonText}
                    </button>
                </div>
            `;
        }

        function renderUploadView() {
            const maxPhotos = 4;
            const uploadButtonClass = uploadFormComplete ? 'btn-primary hover:bg-blue-700' : 'btn-disabled';

            return `
                <div class="max-w-3xl mx-auto px-4 pt-24 pb-16 min-h-screen">
                    <h2 class="text-3xl font-bold text-slate-900 mb-2">Create Secured Album</h2>
                    <p class="text-slate-600 mb-8">Share photos securely with OTP protection</p>
                    
                    <div class="bg-white rounded-xl card-shadow p-6 mb-6 border border-slate-200">
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-blue-600 font-bold">1</span>
                            </div>
                            <h3 class="text-lg font-semibold text-slate-900">Your Information</h3>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Full Name</label>
                                <input type="text" oninput="updateUploaderName(this)" value="${state.uploaderInfo.name}"
                                    class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-slate-900" 
                                    placeholder="Enter your full name" required>
                                <p class="text-xs text-slate-500 mt-1">This name will be shown to viewers</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Email Address</label>
                                <input type="email" oninput="updateUploaderEmail(this)" value="${state.uploaderInfo.email}"
                                    class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-slate-900" 
                                    placeholder="your@email.com" required>
                                <p class="text-xs text-slate-500 mt-1">Used for managing your album</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl card-shadow p-6 mb-6 border border-slate-200">
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-blue-600 font-bold">2</span>
                            </div>
                            <h3 class="text-lg font-semibold text-slate-900">Upload Photos (${state.photos.length}/${maxPhotos})</h3>
                        </div>
                        
                        <div class="border-2 border-dashed border-slate-300 rounded-xl p-8 text-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors" onclick="document.getElementById('file-upload').click()">
                            <input type="file" id="file-upload" accept="image/*" multiple onchange="handleFiles(event)" class="hidden" ${state.photos.length >= maxPhotos ? 'disabled' : ''}>
                            <svg class="mx-auto h-12 w-12 text-slate-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                            <p class="text-sm font-medium text-slate-700">${state.photos.length >= maxPhotos ? 'Maximum photos reached' : 'Click to upload photos'}</p>
                            <p class="text-xs text-slate-500 mt-1">Images only, max ${maxPhotos} files</p>
                        </div>

                        ${state.photos.length > 0 ? `
                            <div class="mt-4 grid grid-cols-4 gap-3">
                                ${state.photos.map((photo, index) => `
                                    <div class="relative group">
                                        <img src="${photo}" class="h-24 w-full object-cover rounded-lg border border-slate-200" alt="Preview">
                                        <button onclick="state.photos.splice(${index}, 1); checkUploadFormComplete(); render();" 
                                            class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-xs font-bold">
                                            ×
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>

                    <div class="bg-white rounded-xl card-shadow p-6 mb-6 border border-slate-200">
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-blue-600 font-bold">3</span>
                            </div>
                            <h3 class="text-lg font-semibold text-slate-900">Terms & Conditions</h3>
                        </div>
                        <div class="flex items-start">
                            <input id="terms-checkbox" type="checkbox" onchange="toggleTerms(this)" ${state.termsAccepted ? 'checked' : ''}
                                class="mt-1 h-5 w-5 text-blue-600 border-slate-300 rounded focus:ring-blue-500 cursor-pointer">
                            <label for="terms-checkbox" class="ml-3 text-sm text-slate-600 leading-relaxed">
                                I agree to the <a href="#" onclick="nav('terms'); return false;" class="text-blue-600 hover:underline font-medium">Terms & Conditions</a> and acknowledge that unauthorized sharing or screenshots may result in legal action.
                            </label>
                        </div>
                    </div>

                    <button onclick="upload()" ${uploadFormComplete ? '' : 'disabled'}
                        class="w-full ${uploadButtonClass} text-white py-4 px-6 rounded-xl font-semibold text-lg transition-all duration-300 shadow-md">
                        Create Album & Generate OTP
                    </button>
                    <p class="text-center text-sm text-slate-500 mt-3">Album access valid for 24 hours</p>
                </div>
            `;
        }

        function renderViewerInputView() {
            const verifyButtonClass = verifyFormComplete ? 'btn-primary hover:bg-blue-700' : 'btn-disabled';

            return `
                <div class="max-w-xl mx-auto px-4 pt-24 pb-16 min-h-screen">
                    <h2 class="text-3xl font-bold text-slate-900 mb-2 text-center">View Secured Album</h2>
                    <p class="text-slate-600 mb-8 text-center">Enter your details to access protected photos</p>
                    
                    <div class="bg-white rounded-xl card-shadow p-8 mb-6 border border-slate-200">
                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Your Full Name</label>
                                <input type="text" oninput="updateViewerName(this)" value="${state.viewerName}"
                                    class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-slate-900" 
                                    placeholder="John Doe" required>
                                <p class="text-xs text-slate-500 mt-1">Your name will be logged for security</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Album ID or Link</label>
                                <input type="text" oninput="updateAlbumId(this)" value="${state.albumIdToView}"
                                    class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-slate-900 font-mono text-sm" 
                                    placeholder="album_xxxxxxxxx or paste full link" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">One-Time Passcode (OTP)</label>
                                <input type="text" oninput="updateViewerOtp(this)" value="${state.viewerOtp}"
                                    class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-slate-900 font-mono text-2xl text-center tracking-widest" 
                                    maxlength="6" placeholder="123456" required>
                            </div>
                        </div>
                    </div>

                    <button onclick="verify()" ${verifyFormComplete ? '' : 'disabled'}
                        class="w-full ${verifyButtonClass} text-white py-4 px-6 rounded-xl font-semibold text-lg transition-all duration-300 shadow-md">
                        Verify & View Photos
                    </button>
                </div>
            `;
        }

        function renderManageInputView() {
            const manageButtonClass = manageFormComplete ? 'bg-orange-600 hover:bg-orange-700' : 'btn-disabled';

            return `
                <div class="max-w-xl mx-auto px-4 pt-24 pb-16 min-h-screen">
                    <h2 class="text-3xl font-bold text-slate-900 mb-2 text-center">Manage Your Album</h2>
                    <p class="text-slate-600 mb-8 text-center">Enter your email to access album controls</p>
                    
                    <div class="bg-white rounded-xl card-shadow p-8 mb-6 border border-orange-200">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Email Address</label>
                            <input type="email" oninput="updateManageEmail(this)" value="${state.manageEmail}"
                                class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-slate-900" 
                                placeholder="your@email.com" required>
                            <p class="text-xs text-slate-500 mt-1">Use the email you provided when creating the album</p>
                        </div>
                    </div>

                    <button onclick="manageAlbum()" ${manageFormComplete ? '' : 'disabled'}
                        class="w-full ${manageButtonClass} text-white py-4 px-6 rounded-xl font-semibold text-lg transition-all duration-300 shadow-md">
                        Load Album
                    </button>
                </div>
            `;
        }

        function nav(e){
            protectionActive=false;
            state.view=e;
            
            window.location.hash = e === 'home' ? '' : e;
            
            if(e==='home'||e==='upload'||e==='manage'||e==='viewer'){
                if(e === 'home' || e === 'upload' || e === 'viewer') {
                    state.photos=[];
                    state.uploaderInfo={name:'',email:''};
                    state.currentAlbum=null;
                }
                state.isVerified=false;
                state.viewerOtp='';
                state.viewerName='';
                state.albumIdToView='';
                state.lightboxIndex=null;
                state.screenshotAttempts=0;
                state.rightClickAttempts=0;
            }
            render()
        }
        
        function toggleTerms(checkbox) {
            state.termsAccepted = checkbox.checked;
            checkUploadFormComplete(); 
            render();
        }
        
        let uploadFormComplete = false;
        
        function checkUploadFormComplete() {
            const isComplete = !!state.uploaderInfo.name && !!state.uploaderInfo.email && state.photos.length > 0 && state.termsAccepted;
            if (isComplete !== uploadFormComplete) {
                uploadFormComplete = isComplete;
                render();
            }
        }
        
        function updateUploaderName(input) {
            state.uploaderInfo.name = input.value;
            checkUploadFormComplete();
        }

        function updateUploaderEmail(input) {
            state.uploaderInfo.email = input.value;
            checkUploadFormComplete();
        }

        let verifyFormComplete = false;
        
        function checkVerifyFormComplete() {
            const isComplete = !!state.albumIdToView && !!state.viewerOtp && state.viewerOtp.length === 6 && !!state.viewerName && state.viewerName.trim().length >= 2;
            if (isComplete !== verifyFormComplete) {
                verifyFormComplete = isComplete;
                render();
            }
            return isComplete;
        }

        function updateAlbumId(input) {
            const value = input.value.trim();
            const urlMatch = value.match(/album=(album_[a-z0-9]+)/);
            state.albumIdToView = urlMatch ? urlMatch[1] : value;
            checkVerifyFormComplete();
        }

        function updateViewerOtp(input) {
            state.viewerOtp = input.value;
            checkVerifyFormComplete();
        }
        
        function updateViewerName(input) {
            state.viewerName = input.value;
            checkVerifyFormComplete();
        }
        
        let manageFormComplete = false;
        
        function checkManageFormComplete() {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const isComplete = emailRegex.test(state.manageEmail);
            if (isComplete !== manageFormComplete) {
                manageFormComplete = isComplete;
                render();
            }
        }

        function updateManageEmail(input) {
            state.manageEmail = input.value;
            checkManageFormComplete();
        }

        function scrambleCanvasPixels(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            
            const width = canvas.offsetWidth || 600; 
            const height = canvas.offsetHeight || 400;

            canvas.width = width;
            canvas.height = height;

            ctx.fillStyle = '#f8fafc'; 
            ctx.fillRect(0, 0, width, height);
            
            ctx.save();
            ctx.fillStyle = 'rgba(239, 68, 68, 0.9)';
            ctx.font = 'bold 50px Inter'; 
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ACCESS DENIED', width / 2, height / 2);
            ctx.restore();

            console.log(`⚡ Canvas ${canvasId} Scrambled!`);
        }

        function handleScreenshotAttempt() {
            const canvasElements = document.querySelectorAll('canvas[id^="secure-photo-"]');
            canvasElements.forEach(canvas => scrambleCanvasPixels(canvas.id));
            
            const overlay = document.getElementById('screenshot-block-overlay');
            if (overlay) {
                overlay.classList.add('active');
                
                console.warn('Screenshot attempt detected:', {
                    album: state.currentAlbum?.id,
                    timestamp: new Date().toISOString(),
                    attemptNumber: state.screenshotAttempts
                });

                setTimeout(() => {
                    overlay.classList.remove('active');
                    nav('home');
                }, 3000); 
            }
        }

        function showScreenshotWarning() {
            state.rightClickAttempts++;
            
            if (state.rightClickAttempts === 1) {
                alert('⚠️ WARNING: Screenshots and screen recording are strictly prohibited!\n\nThis action has been logged. Any further attempts will result in immediate logout.');
            } else if (state.rightClickAttempts >= 2) {
                state.screenshotAttempts++;
                handleScreenshotAttempt();
            }
        }
        
        function setupProtection() {
            if (protectionActive) return;
            protectionActive = true;

            const viewerContent = document.getElementById('viewer-content-area') || document.getElementById('lightbox-container');
            const overlay = document.getElementById('screenshot-block-overlay');
            if (!viewerContent || !overlay) return;

            console.log('🔒 Enhanced protection activated');

            const contextMenuBlocker = e => { 
                e.preventDefault(); 
                showScreenshotWarning();
            };
            
            const keyBlocker = e => {
                if (e.keyCode === 123 || e.key === 'PrintScreen' || 
                    (e.metaKey && e.shiftKey && (e.key === '3' || e.key === '4' || e.key === '5')) ||
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
                    (e.ctrlKey && e.key === 'p')) {
                    e.preventDefault();
                    handleScreenshotAttempt(); 
                }
            };
            
            document.addEventListener('contextmenu', contextMenuBlocker);
            document.addEventListener('keydown', keyBlocker);

            const handleVisibilityChange = () => {
                const now = Date.now();
                const timeSinceLastChange = now - lastVisibilityChange;
                
                if (document.visibilityState === 'hidden') {
                    if (timeSinceLastChange < 1500 && timeSinceLastChange > 50) { 
                        visibilityChangeCount++;
                        
                        if (visibilityChangeCount >= 2) {
                            handleScreenshotAttempt();
                        }
                    } else {
                        visibilityChangeCount = 1;
                    }
                    lastVisibilityChange = now;
                } else if (document.visibilityState === 'visible') {
                    setTimeout(() => { visibilityChangeCount = 0; }, 3000); 
                }
            };

            document.addEventListener('visibilitychange', handleVisibilityChange);

            let blurStartTime = 0;
            
            window.addEventListener('blur', () => {
                blurStartTime = Date.now();
            });

            window.addEventListener('focus', () => {
                if (blurStartTime > 0) {
                    const blurDuration = Date.now() - blurStartTime;
                    
                    if (blurDuration < 500 && blurDuration > 50) {
                        handleScreenshotAttempt(); 
                    }
                    blurStartTime = 0;
                }
            });
        }
        
        function drawPhotoOnCanvas(canvasId, photoData, watermarkText, isLightbox = false) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = () => {
                const imgWidth = img.width;
                const imgHeight = img.height; 
                
                canvas.width = imgWidth;
                canvas.height = imgHeight;
                
                if(isLightbox) {
                    canvas.style.maxWidth = '100%';
                    canvas.style.maxHeight = '90vh';
                    canvas.style.width = 'auto';
                    canvas.style.height = 'auto';
                } else {
                    canvas.style.width = '100%';
                    canvas.style.height = '100%'; 
                }

                ctx.drawImage(img, 0, 0, imgWidth, imgHeight);
                
                ctx.save();
                ctx.globalAlpha = 0.08;
                ctx.fillStyle = 'white';
                
                const watermarkSize = Math.max(100, imgWidth / 10); 
                ctx.font = `bold ${watermarkSize}px Inter`; 
                
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                const centerX = imgWidth / 2;
                const centerY = imgHeight / 2;
                
                ctx.translate(centerX, centerY);
                ctx.rotate(-45 * Math.PI / 180);
                
                ctx.fillText(watermarkText || 'Amanah Secured', 0, 0);
                
                ctx.restore();
            };

            img.onerror = () => {
                console.error(`Failed to load photo data for canvas ${canvasId}`);
                ctx.fillStyle = '#f8fafc';
                canvas.style.width = '100%';
                canvas.style.height = '300px'; 
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#ef4444';
                ctx.font = 'bold 24px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('Image Load Error', canvas.width / 2, canvas.height / 2);
            };

            img.src = photoData;
        }

        function createShareMessage() {
            const albumName = state.currentAlbum ? state.currentAlbum.name : 'Secured Photos';
            const link = state.shareLink;
            const otp = state.otp;
            const expiryTime = state.otpExpiry ? formatTime(state.otpExpiry) : '24 hours';
            return `*--- Amanah Secure Photo Share ---*\n\nHello, here is the link to view the photo album for *${albumName}*.\n\n🔒 *Album Access Details:*\n- *Share Link:* ${link}\n- *One-Time Passcode (OTP):* ${otp}\n\n*Instructions:* Tap the link, then enter the OTP to view the secured photos. The access is valid for ${expiryTime} from now.\n\nRegards,\n${albumName}`;
        }

        function copyText() {
            const message = createShareMessage();
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(message).then(() => {
                    alert('✅ Shareable link & OTP copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy:', err);
                    fallbackCopyText(message);
                });
            } else {
                fallbackCopyText(message);
            }
        }
        
        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                alert('✅ Shareable link & OTP copied to clipboard!');
            } catch (err) {
                console.error('Fallback copy failed:', err);
                alert('❌ Failed to copy. Please copy manually:\n\n' + text);
            }
            document.body.removeChild(textArea);
        }
        
        function copyOtp() {
            const otp = state.otp;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(otp).then(() => {
                    alert('✅ OTP copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy OTP:', err);
                    fallbackCopyText(otp);
                });
            } else {
                fallbackCopyText(otp);
            }
        }

        function copyLink() {
            const link = state.shareLink;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(link).then(() => {
                    alert('✅ Shareable link copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy link:', err);
                    fallbackCopyText(link);
                });
            } else {
                fallbackCopyText(link);
            }
        }

        function shareViaWhatsApp() {
            const message = createShareMessage();
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
        }

        function openLightbox(index){state.lightboxIndex=index;render();setTimeout(setupProtection,100);}
        function closeLightbox(){state.lightboxIndex=null;render();}
        function nextPhoto(){if(state.lightboxIndex<state.currentAlbum.photos.length-1){state.lightboxIndex++;render();setTimeout(setupProtection,100);}}
        function prevPhoto(){if(state.lightboxIndex>0){state.lightboxIndex--;render();setTimeout(setupProtection,100);}}
        
        function openReportModal() {
            state.showReportModal = true;
            state.reportReason = '';
            state.reportDetails = '';
            render();
        }
        
        function closeReportModal() {
            state.showReportModal = false;
            render();
        }
        
        function updateReportReason(select) {
            state.reportReason = select.value;
        }
        
        function updateReportDetails(textarea) {
            state.reportDetails = textarea.value;
        }
        
        async function submitReport() {
            if (!state.reportReason) {
                alert('Please select a reason for reporting.');
                return;
            }
            
            state.loading = true;
            render();
            
            try {
                const reportData = {
                    album_id: state.currentAlbum.id,
                    uploader_name: state.currentAlbum.name,
                    uploader_email: state.currentAlbum.email,
                    report_reason: state.reportReason,
                    report_details: state.reportDetails || 'No additional details provided',
                    reported_at: new Date().toISOString(),
                    reporter_ip: 'Not captured'
                };
                
                const { error: dbError } = await supabaseClient.from('reports').insert(reportData);
                
                if (dbError) {
                    console.error('Database error:', dbError);
                }
                
                const emailSubject = `🚨 URGENT: User Report - ${state.reportReason}`;
                const emailBody = `
AMANAH PLATFORM - USER REPORT ALERT

Report Time: ${new Date().toLocaleString()}

REPORTED ALBUM DETAILS:
- Album ID: ${state.currentAlbum.id}
- Uploader Name: ${state.currentAlbum.name}
- Uploader Email: ${state.currentAlbum.email}

REPORT DETAILS:
- Reason: ${state.reportReason}
- Additional Details: ${state.reportDetails || 'None provided'}

RECOMMENDED ACTIONS:
1. Review the album content immediately
2. Contact the uploader at: ${state.currentAlbum.email}
3. Consider suspending or removing the album
4. Document this incident for compliance records

This is an automated alert from the Amanah reporting system.
                `.trim();
                
                const mailtoLink = `mailto:support@picamanah.space?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
                
                window.location.href = mailtoLink;
                
                state.loading = false;
                state.showReportModal = false;
                
                alert('Thank you for your report. The platform administrator has been notified and will review this album immediately. Your report helps keep Amanah safe for everyone.');
                
                setTimeout(() => {
                    nav('home');
                }, 2000);
                
                render();
            } catch (error) {
                console.error('Report error:', error);
                alert('Failed to submit report. Please try again or contact support@picamanah.space directly.');
                state.loading = false;
                render();
            }
        }
        
        function handleFiles(e){
            const maxPhotos = 4;
            const t=Array.from(e.target.files);
            Promise.all(t.map(e=>new Promise(t=>{
                const n=new FileReader();
                n.onload=e=>t(e.target.result);
                n.readAsDataURL(e)
            }))).then(e=>{
                state.photos=[...state.photos,...e].slice(0, maxPhotos);
                checkUploadFormComplete();
                render()
            })
        }
        
        async function manageAlbum(){ 
            if(!manageFormComplete){alert('Please enter a valid email address.');return}
            state.loading=true;render();
            try{
                const{data:albums,error}=await supabaseClient.from('albums').select('*').eq('email',state.manageEmail.trim().toLowerCase()).limit(1);
                if(error)throw error;
                if(!albums||albums.length===0){
                    alert('No albums found with this email address.');
                    state.loading=false;
                    render();
                    return
                }
                const album=albums[0];
                const{data:photos}=await supabaseClient.from('photos').select('*').eq('album_id',album.id).order('created_at',{ascending:true});
                state.currentAlbum={...album,photos:photos.map(p=>p.photo_data)};
                state.otp=album.otp;
                state.otpExpiry=album.otp_expiry;
                state.shareLink=window.location.origin+window.location.pathname+'?album='+album.id;
                state.view='gallery';
                state.loading=false;
                render();
            }catch(e){
                console.error('Manage error:',e);
                alert('Failed to load albums: '+e.message);
                state.loading=false;
                render();
            }
        }
        
        async function upload(){
            if (!state.termsAccepted) {
                alert('You must accept the Terms & Conditions before creating an album.');
                return;
            }
            if(!state.uploaderInfo.name||!state.uploaderInfo.email||!state.photos.length){alert('Please fill all required fields and upload at least one photo');return}state.loading=true;render();try{const e=genAlbumId(),t=genOTP(),n=Date.now()+864e5,{data:a,error:o}=await supabaseClient.from('albums').insert({id:e,name:state.uploaderInfo.name,email:state.uploaderInfo.email.trim().toLowerCase(),otp:t,otp_expiry:n,created_at:Date.now()}).select().single();if(o)throw o;const{error:r}=await supabaseClient.from('photos').insert(state.photos.map(t=>({album_id:e,photo_data:t})));if(r)throw r;const{data:s,error:i}=await supabaseClient.from('photos').select('*').eq('album_id',e).order('created_at',{ascending:true});if(i)throw i;state.currentAlbum={...a,photos:s.map(e=>e.photo_data)};state.otp=t;state.otpExpiry=n;state.shareLink=window.location.origin+window.location.pathname+'?album='+e;state.view='gallery';state.loading=false;render()}catch(e){console.error('Upload error:',e);alert('Failed to create album: '+e.message);state.loading=false;render()}}

        async function regenOTP(){
            if(!state.currentAlbum)return;
            
            const duration = prompt('Select OTP validity duration:\n\n1 = 24 hours (1 day)\n3 = 3 days\n6 = 6 days\n\nEnter number (1, 3, or 6):', '1');
            
            if (!duration) return;
            
            const durationNum = parseInt(duration);
            if (![1, 3, 6].includes(durationNum)) {
                alert('Invalid duration. Please enter 1, 3, or 6.');
                return;
            }
            
            state.loading=true;
            render();
            try{
                const e=genOTP();
                const t=Date.now()+(durationNum * 864e5);
                
                const {error:n}=await supabaseClient.from('albums').update({
                    otp:e,
                    otp_expiry:t
                }).eq('id',state.currentAlbum.id);

                if(n)throw n;
                
                state.currentAlbum.otp=e;
                state.otp=e;
                state.otpExpiry=t;
                state.loading=false;
                alert(`New OTP generated successfully! Access is now valid for the next ${durationNum} day(s).`);
                render();
            }catch(e){
                console.error('OTP error:',e);
                alert('Failed to regenerate OTP: '+e.message);
                state.loading=false;
                render();
            }
        }
        
        async function expireOTP(){
            if(!state.currentAlbum)return;if(!confirm('Expire OTP now? This will immediately block all access to your album.'))return;state.loading=true;render();try{const e=Date.now()-1000,{error:t}=await supabaseClient.from('albums').update({otp_expiry:e}).eq('id',state.currentAlbum.id);if(t)throw t;state.currentAlbum.otp_expiry=e;state.otpExpiry=e;state.loading=false;alert('OTP expired successfully! No one can access this album now.');render()}catch(e){console.error('Expire OTP error:',e);alert('Failed to expire OTP: '+e.message);state.loading=false;render()}}
        
        async function verify(){
            if(!verifyFormComplete){alert('Please enter your name, a valid Album ID, and a 6-digit OTP.');return}
            state.loading=true;render();
            try{
                const{data:e,error:t}=await supabaseClient.from('albums').select('*').eq('id',state.albumIdToView).single();
                if(t||!e){alert('Album not found. Please check your Album ID.');state.loading=false;render();return}
                
                const isExpired = Date.now() > e.otp_expiry;
                if(isExpired){alert('OTP has expired. Please contact the album owner to regenerate it.');state.loading=false;render();return}
                
                if(e.otp!==state.viewerOtp){alert('Invalid OTP. Please check and try again.');state.loading=false;render();return}
                
                const{data:n,error:a}=await supabaseClient.from('photos').select('*').eq('album_id',state.albumIdToView).order('created_at',{ascending:true});
                if(a)throw a;
                
                const accessLog = {
                    album_id: state.albumIdToView,
                    viewer_name: state.viewerName.trim(),
                    accessed_at: new Date().toISOString(),
                    uploader_email: e.email
                };
                
                const {error: logError} = await supabaseClient.from('access_logs').insert(accessLog);
                if(logError) console.error('Failed to log access:', logError);
                
                state.currentAlbum={...e,photos:n.map(e=>e.photo_data)};
                state.isVerified=true;
                state.view='view';
                state.loading=false;
                render();
            }catch(e){
                console.error('Verify error:',e);
                alert('Failed to verify album: '+e.message);
                state.loading=false;
                render();
            }
        }
        
        async function delPhoto(e){
            if(!confirm('Are you sure you want to delete this photo?'))return;state.loading=true;render();try{const{data:t,error:n}=await supabaseClient.from('photos').select('id').eq('album_id',state.currentAlbum.id).order('created_at',{ascending:true});if(n)throw n;if(t.length===1){if(confirm('This is the last photo. Delete the entire album?')){await delAlbum();return}else{state.loading=false;render();return}}const a=t[e],{error:o}=await supabaseClient.from('photos').delete().eq('id',a.id);if(o)throw o;state.currentAlbum.photos=state.currentAlbum.photos.filter((t,n)=>n!==e);state.loading=false;alert('Photo deleted successfully');render()}catch(e){console.error('Delete error:',e);alert('Failed to delete photo: '+e.message);state.loading=false;render()}}
        
        async function delAlbum(){
            if(!confirm('Are you sure you want to delete this entire album? This action cannot be undone.'))return;state.loading=true;render();try{const{error:e}=await supabaseClient.from('albums').delete().eq('id',state.currentAlbum.id);if(e)throw e;state.view='home';state.currentAlbum=null;state.loading=false;alert('Album deleted successfully');render()}catch(e){console.error('Delete error:',e);alert('Failed to delete album: '+e.message);state.loading=false;render()}}

        async function loadAccessLogs() {
            if (!state.currentAlbum) return;
            
            const container = document.getElementById('access-logs-container');
            container.innerHTML = '<div class="text-slate-600 text-sm">Loading access logs...</div>';
            
            try {
                const { data: logs, error } = await supabaseClient
                    .from('access_logs')
                    .select('*')
                    .eq('album_id', state.currentAlbum.id)
                    .order('accessed_at', { ascending: false });
                
                if (error) throw error;
                
                if (!logs || logs.length === 0) {
                    container.innerHTML = '<div class="text-slate-500 text-sm bg-slate-50 p-4 rounded-lg">No access logs yet. When someone views your album, their name and access time will appear here.</div>';
                    return;
                }
                
                const logsHtml = logs.map((log, index) => {
                    const accessDate = new Date(log.accessed_at);
                    const formattedDate = accessDate.toLocaleString('en-US', {
                        month: 'short',
                        day: 'numeric',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    return `
                        <div class="bg-white border border-slate-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="bg-blue-100 w-10 h-10 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-blue-700 font-semibold text-lg">${log.viewer_name.charAt(0).toUpperCase()}</span>
                                    </div>
                                    <div>
                                        <p class="text-slate-900 font-medium">${log.viewer_name}</p>
                                        <p class="text-slate-500 text-xs">${formattedDate}</p>
                                    </div>
                                </div>
                                <div class="text-green-600 text-xs font-semibold">
                                    ✓ Viewed
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = `
                    <div class="space-y-3 max-h-96 overflow-y-auto">
                        <p class="text-sm text-slate-600 mb-2">Total views: <span class="font-semibold text-slate-900">${logs.length}</span></p>
                        ${logsHtml}
                    </div>
                `;
                
            } catch (error) {
                console.error('Failed to load access logs:', error);
                container.innerHTML = '<div class="text-red-600 text-sm">Failed to load access logs. Please try again.</div>';
            }
        }

        function renderHeader() {
            const showMyAlbumButton = state.view === 'gallery';
            
            return `
                <header class="bg-white border-b border-slate-200 fixed w-full z-20 shadow-sm">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                        <h1 class="text-2xl font-bold text-slate-900 cursor-pointer flex items-center" onclick="nav('home')">
                            <svg class="w-7 h-7 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                            <span class="text-blue-600">Amanah</span>
                        </h1>
                        <nav class="flex items-center space-x-1">
                            <button onclick="nav('home')" class="text-sm font-medium px-4 py-2 rounded-lg transition-colors ${state.view === 'home' ? 'bg-blue-50 text-blue-600' : 'text-slate-600 hover:text-slate-900 hover:bg-slate-50'}">
                                Home
                            </button>
                            <button onclick="nav('about')" class="text-sm font-medium px-4 py-2 rounded-lg transition-colors ${state.view === 'about' ? 'bg-blue-50 text-blue-600' : 'text-slate-600 hover:text-slate-900 hover:bg-slate-50'}">
                                About
                            </button>
                            ${showMyAlbumButton ? `
                                <button onclick="nav('gallery')" class="text-sm font-medium px-4 py-2 rounded-lg transition-colors ${state.view === 'gallery' ? 'bg-blue-50 text-blue-600' : 'text-slate-600 hover:text-slate-900 hover:bg-slate-50'}">
                                    My Album
                                </button>
                            ` : ''}
                        </nav>
                    </div>
                </header>
            `;
        }
        
        function renderFooter(){ 
            return `
                <footer class="bg-white border-t border-slate-200 mt-16">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                        <div class="grid md:grid-cols-3 gap-8">
                            <div>
                                <h3 class="text-sm font-semibold text-slate-900 mb-4">Legal & Security</h3>
                                <ul class="space-y-2 text-sm">
                                    <li><a href="#" onclick="nav('terms'); return false;" class="text-slate-600 hover:text-blue-600 transition-colors">Terms & Conditions</a></li>
                                    <li class="text-red-600 font-medium">⚠️ Cybercrime Warning</li>
                                </ul>
                            </div>
                            <div>
                                <h3 class="text-sm font-semibold text-slate-900 mb-4">Quick Links</h3>
                                <ul class="space-y-2 text-sm">
                                    <li><a href="#" onclick="nav('about'); return false;" class="text-slate-600 hover:text-blue-600 transition-colors">About Amanah</a></li>
                                </ul>
                            </div>
                            <div>
                                <h3 class="text-sm font-semibold text-slate-900 mb-4">Contact</h3>
                                <p class="text-sm text-slate-600 mb-2">Email</p>
                                <a href="mailto:support@picamanah.space" class="text-sm text-blue-600 hover:text-blue-700 transition-colors">support@picamanah.space</a>
                                <div class="mt-4">
                                    <a href="https://www.linkedin.com/in/syed-rashad/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-sm text-blue-600 hover:text-blue-700 transition-colors">
                                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                                        LinkedIn
                                    </a>
                                </div>
                                <p class="text-xs text-slate-500 mt-4">© 2025 Amanah by Syed Rashad</p>
                            </div>
                        </div>
                        <div class="border-t border-slate-200 mt-8 pt-8 text-center text-xs text-slate-500">أمانة - Trustworthy Protection</div>
                    </div>
                </footer>
            `;
        }

        function renderLoading(){ 
            return '<div class="fixed inset-0 bg-white bg-opacity-95 z-50 flex flex-col items-center justify-center"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div><span class="mt-4 text-lg font-medium text-slate-700">Processing...</span></div>';
        }

        function renderHomeView() {
            return `
            <div class="min-h-screen pt-20">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    
                    <!-- Hero Section -->
                    <div class="text-center py-16">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-2xl mb-6">
                            <svg class="w-9 h-9 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                        </div>
                        <h1 class="text-5xl font-bold text-slate-900 mb-4 tracking-tight">Amanah</h1>
                        <p class="text-2xl text-blue-600 font-medium mb-6">Privacy-First Photo Sharing for Matrimonial Profiles</p>
                        <p class="text-lg text-slate-600 max-w-3xl mx-auto leading-relaxed">
                            Share sensitive photos with time-bound access, OTP protection, and complete control. Built for families seeking dignity in the marriage process.
                        </p>
                    </div>

                    <!-- Action Cards -->
                    <div class="grid md:grid-cols-3 gap-8 mb-20">
                        ${actionCard(
                            'Upload Photos',
                            '<svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>',
                            '<p>• Secure upload up to 4 photos</p><p>• OTP-protected access</p><p>• Full ownership and control</p>',
                            'Create New Album',
                            "nav('upload')",
                            'blue'
                        )}
                        ${actionCard(
                            'Manage Access',
                            '<svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>',
                            '<p>• Regenerate or expire OTP</p><p>• View access logs</p><p>• Delete album anytime</p>',
                            'Manage Album',
                            "nav('manage')",
                            'orange'
                        )}
                        ${actionCard(
                            'View Photos',
                            '<svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>',
                            '<p>• Requires OTP verification</p><p>• Screenshot protected</p><p>• Single-session access</p>',
                            'View Album',
                            "nav('viewer')",
                            'green'
                        )}
                    </div>

                    <!-- Trust Indicators -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-10 mb-16">
                        <h2 class="text-2xl font-bold text-slate-900 text-center mb-10">Why Families Trust Amanah</h2>
                        <div class="grid md:grid-cols-3 gap-8 text-center">
                            <div>
                                <div class="inline-flex items-center justify-center w-12 h-12 bg-blue-100 rounded-xl mb-4">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                                </div>
                                <h3 class="font-semibold text-slate-900 mb-2">OTP Protected</h3>
                                <p class="text-sm text-slate-600">Time-limited access codes ensure photos are viewed only by intended recipients</p>
                            </div>
                            <div>
                                <div class="inline-flex items-center justify-center w-12 h-12 bg-green-100 rounded-xl mb-4">
                                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                </div>
                                <h3 class="font-semibold text-slate-900 mb-2">No Downloads</h3>
                                <p class="text-sm text-slate-600">Photos are rendered securely and cannot be saved, forwarded, or downloaded</p>
                            </div>
                            <div>
                                <div class="inline-flex items-center justify-center w-12 h-12 bg-orange-100 rounded-xl mb-4">
                                    <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                </div>
                                <h3 class="font-semibold text-slate-900 mb-2">Full Control</h3>
                                <p class="text-sm text-slate-600">Revoke access anytime, see who viewed your photos, delete permanently</p>
                            </div>
                        </div>
                    </div>

                </div>
                ${renderFooter()}
            </div>
            `;
        }
