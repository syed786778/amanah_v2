<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Amanah - Secure marriage profile photo sharing with OTP protection by Syed Rashad">
    <title>Amanah - Secure Photo Sharing</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        blue: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
    </style>

    <script>
        function renderGalleryView() {
            if (!state.currentAlbum) {
                return `
                    <div class="max-w-xl mx-auto px-4 pt-24 pb-16 text-center">
                        <div class="bg-white rounded-xl card-shadow p-8 border border-slate-200">
                            <svg class="w-16 h-16 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            <h2 class="text-2xl font-bold text-slate-900 mb-2">Album Not Found</h2>
                            <p class="text-slate-600 mb-6">Please return home and try accessing your album again.</p>
                            <button onclick="nav('home')" class="btn-primary text-white py-3 px-6 rounded-lg font-semibold shadow-md">Go Home</button>
                        </div>
                    </div>
                `;
            }

            const isExpired = Date.now() > state.otpExpiry;
            const otpStatus = isExpired 
                ? `<span class="text-red-600 font-semibold">EXPIRED</span>`
                : `<span class="text-green-600 font-semibold">${formatTime(state.otpExpiry)} remaining</span>`;

            return `
                <div class="max-w-7xl mx-auto px-4 pt-24 pb-16 min-h-screen">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-900 mb-2">My Secured Album</h2>
                        <p class="text-slate-600">Created by ${state.currentAlbum.name}</p>
                    </div>

                    <div class="bg-gradient-to-br from-blue-50 to-white rounded-xl card-shadow p-6 mb-6 border border-blue-100">
                        <h3 class="text-xl font-bold text-slate-900 mb-4 flex items-center">
                            <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
                            Share Access Details
                        </h3>
                        
                        <div class="space-y-4 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Album Link</label>
                                <div class="flex gap-2">
                                    <input type="text" value="${state.shareLink}" readonly class="flex-grow px-4 py-2 bg-white border border-slate-300 rounded-lg text-slate-900 text-sm font-mono" />
                                    <button onclick="copyLink()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap">
                                        Copy Link
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Current OTP</label>
                                <div class="flex gap-2">
                                    <input type="text" value="${state.otp}" readonly class="flex-grow px-4 py-2 bg-white border border-slate-300 rounded-lg text-slate-900 text-2xl font-mono text-center tracking-widest" />
                                    <button onclick="copyOtp()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap">
                                        Copy OTP
                                    </button>
                                </div>
                                <p class="text-sm text-slate-600 mt-2">Expires in: ${otpStatus}</p>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="shareViaWhatsApp()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition-colors flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
                                Share via WhatsApp
                            </button>
                            <button onclick="copyText()" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-3 rounded-lg font-medium transition-colors">
                                Copy Full Message
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl card-shadow p-6 mb-6 border border-slate-200">
                        <h3 class="text-xl font-bold text-slate-900 mb-4 flex items-center">
                            <svg class="w-6 h-6 text-slate-700 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                            Access Logs
                        </h3>
                        <button onclick="loadAccessLogs()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg font-medium transition-colors shadow-sm mb-4">
                            View Access History
                        </button>
                        <div id="access-logs-container"></div>
                    </div>

                    <div class="bg-white rounded-xl card-shadow p-6 mb-6 border border-red-100">
                        <h3 class="text-xl font-bold text-slate-900 mb-4 flex items-center">
                            <svg class="w-6 h-6 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                            Access Control
                        </h3>
                        <div class="grid md:grid-cols-3 gap-3">
                            <button onclick="regenOTP()" class="bg-amber-600 hover:bg-amber-700 text-white py-3 rounded-lg font-medium transition-colors shadow-sm">
                                Regenerate OTP
                            </button>
                            <button onclick="expireOTP()" class="bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-medium transition-colors shadow-sm">
                                Expire OTP Now
                            </button>
                            <button onclick="delAlbum()" class="bg-slate-700 hover:bg-slate-800 text-white py-3 rounded-lg font-medium transition-colors shadow-sm">
                                Delete Album
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl card-shadow p-6 border border-slate-200">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">Photos (${state.currentAlbum.photos.length})</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4">
                            ${state.currentAlbum.photos.map((photo, index) => `
                                <div class="relative group cursor-pointer" onclick="openLightbox(${index})">
                                    <img src="${photo}" class="w-full h-32 object-cover rounded-lg border border-slate-200 transition-transform group-hover:scale-105" alt="Photo ${index + 1}">
                                    <button onclick="event.stopPropagation(); delPhoto(${index})" class="absolute top-2 right-2 w-7 h-7 bg-red-500 hover:bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-sm font-bold shadow-lg">
                                        ×
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                ${renderFooter()}
            `;
        }
        
        function renderViewerView() {
            if (!state.currentAlbum || !state.isVerified) {
                return `
                    <div class="max-w-xl mx-auto px-4 pt-24 pb-16 text-center">
                        <div class="bg-white rounded-xl card-shadow p-8 border border-slate-200">
                            <svg class="w-16 h-16 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                            <h2 class="text-2xl font-bold text-slate-900 mb-2">Access Denied</h2>
                            <p class="text-slate-600 mb-6">Please verify your credentials to view photos.</p>
                            <button onclick="nav('home')" class="btn-primary text-white py-3 px-6 rounded-lg font-semibold shadow-md">Go Home</button>
                        </div>
                    </div>
                `;
            }

            const isExpired = Date.now() > state.currentAlbum.otp_expiry;
            const timeRemaining = formatTime(state.currentAlbum.otp_expiry);

            const otpStatus = isExpired 
                ? `<span class="text-red-600 font-semibold">EXPIRED</span>`
                : `<span class="text-green-600 font-semibold">${timeRemaining} remaining</span>`;

            return `
                <div class="max-w-7xl mx-auto px-4 pt-24 pb-16 min-h-screen" id="viewer-content-area">
                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center w-14 h-14 bg-blue-100 rounded-xl mb-4">
                            <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                        </div>
                        <h2 class="text-3xl font-bold text-slate-900 mb-2">Secured Album</h2>
                        <p class="text-lg text-slate-600 mb-1">Shared by: <span class="font-semibold text-slate-900">${state.currentAlbum.name}</span></p>
                        <div class="inline-flex items-center bg-red-50 border border-red-200 rounded-full px-4 py-2 mt-2">
                            <svg class="w-4 h-4 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                            <span class="text-sm font-medium text-red-800">Screenshots strictly prohibited</span>
                        </div>
                        <p class="text-sm text-slate-500 mt-2">Access expires in: ${otpStatus}</p>
                    </div>

                    <div class="mb-8 flex justify-center">
                        <button onclick="openReportModal()" class="inline-flex items-center bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 shadow-md hover:shadow-lg">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                            Report Inappropriate Content
                        </button>
                    </div>

                    <h3 class="text-xl font-bold text-slate-900 mb-4">Protected Photos (${state.currentAlbum.photos.length})</h3>
                    <p class="text-sm text-slate-600 mb-6">Click any photo to view securely</p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6">
                        ${state.currentAlbum.photos.map((photo, index) => `
                            <div class="bg-white rounded-xl card-shadow-hover overflow-hidden border border-slate-200 cursor-pointer group" onclick="openLightbox(${index})">
                                <div class="viewer-thumbnail relative">
                                    <svg class="w-12 h-12 text-blue-400 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                                    <div class="absolute bottom-3 left-0 right-0 text-center">
                                        <span class="text-xs font-medium text-slate-600 bg-white bg-opacity-90 px-3 py-1 rounded-full">Click to View</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button onclick="nav('home')" class="w-full mt-12 bg-slate-700 hover:bg-slate-800 text-white py-4 rounded-xl font-semibold transition-colors shadow-md">
                        Close & Logout
                    </button>
                </div>
                ${renderFooter()}
            `;
        }

        function renderAboutView() {
            return `
                <div class="min-h-screen pt-24 pb-16">
                    <div class="max-w-4xl mx-auto px-4">
                        <div class="bg-gradient-to-br from-blue-50 to-white rounded-2xl card-shadow p-10 mb-10 border border-blue-100">
                            <h2 class="text-3xl font-bold text-slate-900 text-center mb-6">About Amanah</h2>
                            
                            <div class="space-y-5 text-slate-700 leading-relaxed">
                                <p>
                                    Amanah is a privacy-first photo sharing platform designed specifically for sensitive matrimonial use cases. In traditional photo sharing, families lose control the moment a photo is sent—it can be saved, forwarded, and circulated indefinitely without consent.
                                </p>
                                
                                <p class="text-lg font-semibold text-blue-700">
                                    Amanah changes that by putting control back in your hands.
                                </p>
                                
                                <p>
                                    Using OTP-based authentication, time-bound access, and screenshot protection, Amanah ensures that matrimonial photos are viewed only by intended recipients and can be revoked at any time.
                                </p>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-2xl card-shadow p-10 border border-slate-200">
                            <h3 class="text-2xl font-bold text-slate-900 mb-6">About the Founder</h3>
                            
                            <div class="space-y-5 text-slate-700 leading-relaxed">
                                <p>
                                    Amanah was created by <span class="font-semibold text-slate-900">Syed Rashad</span>, who experienced firsthand how matrimonial photos are shared across families, relatives, and broker networks—often reaching unintended recipients with zero accountability.
                                </p>
                                
                                <p>
                                    Recognizing this as a structural problem requiring a technical solution, he built Amanah to embed privacy and consent directly into the photo-sharing process.
                                </p>
                                
                                <div class="bg-blue-50 border-l-4 border-blue-600 p-5 rounded-r-xl my-6">
                                    <p class="text-lg font-medium text-blue-900 italic">
                                        "Sharing a matrimonial photo is an act of trust—and that trust deserves protection."
                                    </p>
                                </div>
                                
                                <div class="flex justify-center mt-8">
                                    <a href="https://www.linkedin.com/in/syed-rashad/" target="_blank" rel="noopener noreferrer" 
                                       class="inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-all duration-300 shadow-md hover:shadow-lg">
                                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                                        Connect on LinkedIn
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                ${renderFooter()}
            `;
        }

        function renderTermsView() {
            return `
                <div class="max-w-4xl mx-auto px-4 pt-24 pb-16 min-h-screen">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Terms & Conditions</h2>
                    <div class="bg-white rounded-xl card-shadow p-8 space-y-6 text-slate-700 border border-slate-200">
                        <div class="bg-red-50 border-l-4 border-red-600 p-4 rounded-r-lg">
                            <p class="font-bold text-red-900 mb-2">⚠️ CYBERCRIME WARNING</p>
                            <p class="text-sm text-red-800">Unauthorized sharing, screenshots, and screen recording are strictly prohibited and may result in legal action.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-bold text-slate-900 mb-3">1. Prohibition of Reproduction</h3>
                            <p class="text-sm leading-relaxed">You are explicitly prohibited from reproducing, screen capturing, screen recording, forwarding, distributing, or copying any content accessed through Amanah. Violations will result in immediate termination of access and may lead to legal action under applicable cybercrime laws.</p>
                        </div>

                        <div>
                            <h3 class="text-xl font-bold text-slate-900 mb-3">2. Access and OTP</h3>
                            <p class="text-sm leading-relaxed">Access is granted via a unique, time-limited One-Time Passcode (OTP). The OTP is non-transferable and for your personal viewing only. Photos are intended solely for matrimonial consideration.</p>
                        </div>

                        <div>
                            <h3 class="text-xl font-bold text-slate-900 mb-3">3. Security Mechanisms</h3>
                            <p class="text-sm leading-relaxed">Amanah employs canvas rendering, watermarking, and screenshot detection as deterrents. While these mechanisms provide strong protection, no system is 100% foolproof against determined technical circumvention.</p>
                        </div>

                        <div>
                            <h3 class="text-xl font-bold text-slate-900 mb-3">4. Uploader Responsibility</h3>
                            <p class="text-sm leading-relaxed">Uploaders warrant they have the legal right to share photos uploaded. Amanah is not responsible for album content. Contact information is used for account management and security logging only.</p>
                        </div>
                        
                        <div class="text-center pt-6">
                            <button onclick="nav('home')" class="btn-primary text-white py-3 px-8 rounded-lg font-semibold shadow-md">
                                I Understand and Agree
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            let content = renderHeader();

            if (state.loading) {
                content += renderLoading();
            } else {
                switch (state.view) {
                    case 'home':
                        content += renderHomeView();
                        break;
                    case 'about':
                        content += renderAboutView();
                        break;
                    case 'terms':
                        content += renderTermsView();
                        break;
                    case 'gallery':
                        content += renderGalleryView();
                        break;
                    case 'viewer':
                        content += renderViewerView();
                        break;
                }
            }
            content += renderReportModal();
            content += renderLightbox();
            app.innerHTML = content;
        }
    </script>
</head>
<body>
    <div id="app"></div>
</body>
</html>
