<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Amanah – Secure Matrimony Photo Sharing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Amanah – Secure, consent-based matrimony photo sharing" />

  <!-- Tailwind CDN (acceptable for MVP) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      background: radial-gradient(circle at top, #0f172a, #020617);
    }
    .no-select {
      user-select: none;
      -webkit-user-select: none;
    }
  </style>
</head>

<body class="text-slate-100 no-select">

<div id="app" class="min-h-screen"></div>

<script>
/* =========================
   CONFIG
========================= */
const SUPABASE_URL = "YOUR_SUPABASE_URL";
const SUPABASE_KEY = "YOUR_SUPABASE_ANON_KEY";
const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_KEY);

/* =========================
   GLOBAL STATE
========================= */
const state = {
  view: "home",              // home | upload | manage | viewer
  albumIdToView: null,
  isVerified: false,
  otp: "",
  viewerName: "",
  photos: [],
  uploadFiles: [],
};

/* =========================
   UTILITIES
========================= */
function nav(view) {
  state.view = view;
  render();
}

function el(html) {
  return html.trim();
}

/* =========================
   BOOTSTRAP FROM URL
========================= */
function bootstrapFromURL() {
  const params = new URLSearchParams(window.location.search);
  const album = params.get("album");
  if (album) {
    state.albumIdToView = album;
    state.view = "viewer";
  }
}

/* =========================
   RENDER ROOT
========================= */
function render() {
  const app = document.getElementById("app");
  let content = "";

  switch (state.view) {
    case "home":
      content = renderHome();
      break;
    case "upload":
      content = renderUpload();
      break;
    case "manage":
      content = renderManage();
      break;
    case "viewer":
      content = renderViewer();
      break;
    default:
      content = renderHome();
  }

  app.innerHTML = content;
}

/* =========================
   VIEWS
========================= */

function renderHome() {
  return el(`
    <div class="max-w-4xl mx-auto px-6 py-24 text-center">
      <h1 class="text-4xl md:text-5xl font-bold mb-6">Amanah</h1>
      <p class="text-slate-300 mb-10">
        Secure, consent-based photo sharing for matrimony.<br/>
        No forwarding. No misuse. Full control.
      </p>

      <div class="flex flex-col md:flex-row gap-4 justify-center">
        <button onclick="nav('upload')" class="px-6 py-3 rounded-xl bg-emerald-600 hover:bg-emerald-700">
          Create Album
        </button>
        <button onclick="nav('viewer')" class="px-6 py-3 rounded-xl bg-slate-700 hover:bg-slate-600">
          View Album
        </button>
      </div>
    </div>
  `);
}

function renderUpload() {
  return el(`
    <div class="max-w-3xl mx-auto px-6 py-16">
      <h2 class="text-3xl font-semibold mb-6">Create Secure Album</h2>

      <input type="file" multiple accept="image/*"
        onchange="handleUploadFiles(event)"
        class="block w-full mb-6 text-slate-200"/>

      <button onclick="createAlbum()"
        class="px-6 py-3 bg-emerald-600 rounded-xl hover:bg-emerald-700">
        Create Album & Generate Link
      </button>

      <div class="mt-8">
        <button onclick="nav('home')" class="text-slate-400 underline">
          Back to Home
        </button>
      </div>
    </div>
  `);
}

function renderManage() {
  return el(`
    <div class="max-w-3xl mx-auto px-6 py-16">
      <h2 class="text-3xl font-semibold mb-4">Manage Album</h2>
      <p class="text-slate-400">Album management coming next iteration.</p>

      <div class="mt-8">
        <button onclick="nav('home')" class="underline text-slate-400">
          Back to Home
        </button>
      </div>
    </div>
  `);
}

function renderViewer() {
  if (!state.isVerified) {
    return renderVerify();
  }

  return el(`
    <div class="max-w-5xl mx-auto px-6 py-12">
      <h2 class="text-2xl mb-6">Private Album</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        ${state.photos.map(p => `
          <div class="relative">
            <img src="${p}" class="rounded-xl pointer-events-none"/>
            <div class="absolute inset-0 bg-transparent"></div>
          </div>
        `).join("")}
      </div>

      <div class="mt-8">
        <button onclick="nav('home')" class="underline text-slate-400">
          Exit
        </button>
      </div>
    </div>
  `);
}

function renderVerify() {
  return el(`
    <div class="max-w-md mx-auto px-6 py-24">
      <h2 class="text-2xl mb-4">Verify Access</h2>

      <input placeholder="Your name"
        class="w-full mb-4 p-3 rounded bg-slate-800"
        oninput="state.viewerName = this.value"/>

      <input placeholder="OTP"
        class="w-full mb-6 p-3 rounded bg-slate-800"
        oninput="state.otp = this.value"/>

      <button onclick="verifyOTP()"
        class="w-full py-3 bg-emerald-600 rounded-xl">
        Verify & View
      </button>

      <div class="mt-6 text-center">
        <button onclick="nav('home')" class="underline text-slate-400">
          Cancel
        </button>
      </div>
    </div>
  `);
}

/* =========================
   ACTIONS
========================= */

function handleUploadFiles(e) {
  state.uploadFiles = Array.from(e.target.files);
}

async function createAlbum() {
  if (!state.uploadFiles.length) {
    alert("Please select at least one photo.");
    return;
  }

  // Example: convert to base64 (replace with storage later)
  const photos = await Promise.all(
    state.uploadFiles.map(file => new Promise(res => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.readAsDataURL(file);
    }))
  );

  // TODO: save to Supabase table
  const albumId = "album_" + Date.now();

  console.log("Album created:", albumId);

  alert("Album created.\nShare this link:\n" +
    location.origin + "?album=" + albumId
  );

  nav("home");
}

async function verifyOTP() {
  if (!state.otp || !state.viewerName) {
    alert("Enter name and OTP");
    return;
  }

  // TODO: real OTP validation via Supabase
  state.isVerified = true;

  // TODO: fetch photos for album
  state.photos = []; // replace with fetched photos

  render();
}

/* =========================
   BASIC SCREENSHOT DETERRENCE
========================= */
document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("keydown", e => {
  if (e.key === "PrintScreen") {
    alert("Screenshots are disabled on this page.");
    e.preventDefault();
  }
});

/* =========================
   INIT
========================= */
bootstrapFromURL();
render();
</script>

</body>
</html>
