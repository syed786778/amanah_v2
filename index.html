<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Amanah - Secure marriage profile photo sharing with OTP protection">
    <title>Amanah - Secure Matrimonial Photo Sharing</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .btn-gradient-purple {
            background: linear-gradient(135deg, #a855f7, #9333ea);
            transition: all 0.3s ease;
        }
        .btn-gradient-purple:hover { transform: translateY(-1px); opacity: 0.9; }
        
        /* Fixed Photo Container */
        .photo-grid-item {
            width: 100%;
            height: 250px;
            background-color: #1f2937;
            border-radius: 0.75rem;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #374151;
        }
        .photo-grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .screenshot-block-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; z-index: 9999; display: none;
            justify-content: center; align-items: center; flex-direction: column;
        }
        .screenshot-block-overlay.active { display: flex; }
        body { user-select: none; -webkit-user-select: none; overflow-x: hidden; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">
    
    <div id="screenshot-block-overlay" class="screenshot-block-overlay">
        <h2 class="text-2xl font-bold text-white mb-2">⚠️ Screenshot Detected</h2>
        <p class="text-gray-300">Security protocol active. Access suspended.</p>
    </div>

    <div id="app"></div>
    
    <script>
        // --- Supabase Config ---
        const SUPABASE_URL = 'https://imiljivxosyrcosznklh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltaWxqaXZ4b3N5cmNvc3pua2xoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMTIwOTcsImV4cCI6MjA3OTY4ODA5N30.TOgeuC3-RdG2ywIxDz2NWRhLHI4gxTkG4pilaZBqhso';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let state = {
            view: 'home',
            uploaderInfo: { name: '', email: '' },
            photos: [],
            currentAlbum: null,
            shareLink: '',
            otp: '',
            otpExpiry: null,
            manageEmail: '',
            loading: false,
            termsAccepted: false
        };

        // --- Core Functions ---
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                alert("Copied to clipboard!");
            } catch (err) {
                alert("Failed to copy. Please select and copy manually.");
            }
        }

        function nav(v) {
            state.view = v;
            if(v === 'home') { state.photos = []; state.uploaderInfo = {name:'', email:''}; }
            render();
        }

        function handleFiles(e) {
            const files = Array.from(e.target.files);
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    state.photos.push(ev.target.result);
                    render();
                };
                reader.readAsDataURL(file);
            });
        }

        // --- Render Views ---
        function render() {
            const app = document.getElementById('app');
            let content = '';

            if (state.loading) { content = `<div class="p-20 text-center">Loading...</div>`; }
            else {
                switch(state.view) {
                    case 'home': content = renderHome(); break;
                    case 'upload': content = renderUpload(); break;
                    case 'gallery': content = renderGallery(); break;
                    case 'manage': content = renderManage(); break;
                }
            }
            app.innerHTML = content + renderFooter();
        }

        function renderHome() {
            return `
                <div class="pt-20 pb-10 px-4 text-center">
                    <h1 class="text-4xl font-bold text-purple-400 mb-4">Amanah</h1>
                    <p class="mb-8 text-gray-400">Secure, Closed Photo Sharing for Matrimonial Proposals</p>
                    <div class="flex justify-center gap-4">
                        <button onclick="nav('upload')" class="btn-gradient-purple px-8 py-3 rounded-lg font-bold">Create Album</button>
                        <button onclick="nav('manage')" class="bg-gray-700 px-8 py-3 rounded-lg font-bold">Manage Existing</button>
                    </div>
                </div>
            `;
        }

        function renderUpload() {
            return `
                <div class="max-w-2xl mx-auto p-6 bg-gray-800 rounded-xl mt-10">
                    <h2 class="text-2xl font-bold mb-4">Create Secure Album</h2>
                    <input type="text" placeholder="Profile Name (e.g. Family of Ayesha)" oninput="state.uploaderInfo.name=this.value" class="w-full p-3 bg-gray-900 rounded mb-4 border border-gray-700">
                    <input type="email" placeholder="Your Email (for management)" oninput="state.uploaderInfo.email=this.value" class="w-full p-3 bg-gray-900 rounded mb-4 border border-gray-700">
                    <input type="file" multiple accept="image/*" onchange="handleFiles(event)" class="mb-4 text-sm">
                    
                    <div class="grid grid-cols-4 gap-2 mb-4">
                        ${state.photos.map(p => `<div class="h-20 bg-gray-700 rounded overflow-hidden"><img src="${p}" class="w-full h-full object-cover"></div>`).join('')}
                    </div>

                    <label class="flex items-center gap-2 mb-6 text-sm text-gray-400">
                        <input type="checkbox" onchange="state.termsAccepted=this.checked"> I accept the Privacy Policy
                    </label>
                    <button onclick="uploadAction()" class="w-full btn-gradient-purple py-3 rounded-lg font-bold">Generate Secure Link</button>
                </div>
            `;
        }

        function renderGallery() {
            return `
                <div class="max-w-4xl mx-auto p-6">
                    <div class="bg-gray-800 p-6 rounded-xl mb-8 border border-purple-900/30">
                        <h2 class="text-xl font-bold mb-4">${state.uploaderInfo.name || 'Your Album'}</h2>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-gray-900 p-4 rounded border border-gray-700">
                                <p class="text-xs text-gray-500 uppercase font-bold">Share Link</p>
                                <div class="flex gap-2">
                                    <input readonly value="${state.shareLink}" class="bg-transparent text-sm w-full outline-none">
                                    <button onclick="copyToClipboard('${state.shareLink}')" class="text-purple-400 font-bold">Copy</button>
                                </div>
                            </div>
                            <div class="bg-gray-900 p-4 rounded border border-gray-700">
                                <p class="text-xs text-gray-500 uppercase font-bold">Current OTP</p>
                                <div class="flex gap-2">
                                    <span class="text-purple-400 font-mono font-bold text-lg">${state.otp}</span>
                                    <button onclick="copyToClipboard('${state.otp}')" class="ml-auto text-purple-400 font-bold">Copy</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-bold mb-4">Photos in this Album</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                        ${state.photos.length > 0 ? 
                            state.photos.map(src => `
                                <div class="photo-grid-item">
                                    <img src="${src}" alt="Secured Photo">
                                </div>
                            `).join('') : 
                            `<div class="col-span-4 py-10 text-center text-gray-600">No photos found.</div>`
                        }
                    </div>
                </div>
            `;
        }

        function renderManage() {
            return `
                <div class="max-w-md mx-auto p-6 bg-gray-800 rounded-xl mt-10">
                    <h2 class="text-2xl font-bold mb-4">Manage My Album</h2>
                    <p class="text-sm text-gray-400 mb-4">Enter the email you used to create the album.</p>
                    <input type="email" placeholder="email@example.com" oninput="state.manageEmail=this.value" class="w-full p-3 bg-gray-900 rounded mb-4 border border-gray-700">
                    <button onclick="manageAction()" class="w-full bg-purple-600 py-3 rounded-lg font-bold">Find Album</button>
                </div>
            `;
        }

        function renderFooter() {
            return `
                <footer class="bg-gray-900 border-t border-gray-800 mt-20 py-12 px-6">
                    <div class="max-w-6xl mx-auto grid md:grid-cols-3 gap-10">
                        <div class="col-span-1">
                            <h3 class="text-purple-400 font-bold mb-3">About Amanah</h3>
                            <p class="text-sm text-gray-500 leading-relaxed">Privacy-first platform designed for matrimonial trust. We prevent uncontrolled forwarding and circulation of your personal images.</p>
                        </div>
                        <div>
                            <h3 class="text-white font-bold mb-3">About the Founder</h3>
                            <p class="text-sm text-gray-500 mb-4">Amanah is a founder-led initiative by Syed Rashad, committed to building trust-first products for families.</p>
                            <a href="https://www.linkedin.com/in/syed-rashad/" target="_blank" class="inline-flex items-center px-4 py-2 bg-blue-700 hover:bg-blue-600 text-white text-xs font-bold rounded transition-colors">
                                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zM8 19H5V8h3v11zM6.5 6.7c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8 1.8.8 1.8 1.8-.8 1.8-1.8 1.8zM19 19h-3v-5.6c0-1.3-.1-3-1.9-3-1.8 0-2.1 1.4-2.1 2.9V19h-3V8h2.9v1.5h.1c.4-.7 1.4-1.5 2.7-1.5 2.9 0 3.4 1.9 3.4 4.4V19z"/></svg>
                                Connect on LinkedIn
                            </a>
                        </div>
                        <div>
                            <h3 class="text-white font-bold mb-3">Support</h3>
                            <p class="text-sm text-gray-500">help.amanahapp@gmail.com</p>
                            <p class="text-xs text-gray-700 mt-4">© 2025 Amanah by Syed Rashad</p>
                        </div>
                    </div>
                </footer>
            `;
        }

        // --- Mock Actions ---
        function uploadAction() {
            if(!state.termsAccepted) return alert("Accept terms");
            state.otp = Math.floor(100000 + Math.random() * 900000);
            state.shareLink = "https://amanah.app/view?id=temp_123";
            nav('gallery');
        }

        async function manageAction() {
            state.loading = true; render();
            // Simulate API call
            setTimeout(() => {
                state.loading = false;
                state.otp = "988844";
                state.shareLink = "https://amanah.app/view?id=album_abc";
                nav('gallery');
            }, 800);
        }

        // Init
        render();
    </script>
</body>
</html>
